<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2018"><meta name="DC.rights.owner" content="(C) Copyright 2018"><meta name="DC.Type" content="concept"><meta name="DC.Relation" scheme="URI" content="../topics/impala_config.html"><meta name="prodname" content="Impala"><meta name="prodname" content="Impala"><meta name="version" content="Impala 2.8.x"><meta name="version" content="Impala 2.8.x"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="impala_jdbc"><link rel="stylesheet" type="text/css" href="../commonltr.css"><title>Configuring Impala to Work with JDBC</title></head><body id="impala_jdbc"><main role="main"><article role="article" aria-labelledby="impala_jdbc__jdbc">

  <h1 class="title topictitle1" id="impala_jdbc__jdbc">Configuring Impala to Work with JDBC</h1>
  

  <div class="body conbody">

    <p class="p">
      
      Impala supports the standard JDBC interface, allowing access from commercial Business Intelligence tools and
      custom software written in Java or other programming languages. The JDBC driver allows you to access Impala
      from a Java program that you write, or a Business Intelligence or similar tool that uses JDBC to communicate
      with various database products.
    </p>

    <p class="p">
      Setting up a JDBC connection to Impala involves the following steps:
    </p>

    <ul class="ul">
      <li class="li">
        Verifying the communication port where the Impala daemons in your cluster are listening for incoming JDBC
        requests.
      </li>

      <li class="li">
        Installing the JDBC driver on every system that runs the JDBC-enabled application.
      </li>

      <li class="li">
        Specifying a connection string for the JDBC application to access one of the servers running the
        <span class="keyword cmdname">impalad</span> daemon, with the appropriate security settings.
      </li>
    </ul>

    <p class="p toc inpage"></p>
  </div>

  <nav role="navigation" class="related-links"><div class="familylinks"><div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../topics/impala_config.html">Managing Impala</a></div></div></nav><article class="topic concept nested1" aria-labelledby="ariaid-title2" id="impala_jdbc__jdbc_port">

    <h2 class="title topictitle2" id="ariaid-title2">Configuring the JDBC Port</h2>

    <div class="body conbody">

      <p class="p">
        The default port used by JDBC 2.0 and later (as well as ODBC 2.x) is 21050. Impala server accepts JDBC
        connections through this same port 21050 by default. Make sure this port is available for communication
        with other hosts on your network, for example, that it is not blocked by firewall software. If your JDBC
        client software connects to a different port, specify that alternative port number with the
        <code class="ph codeph">--hs2_port</code> option when starting <code class="ph codeph">impalad</code>. See
        <a class="xref" href="impala_processes.html#processes">Starting Impala</a> for details about Impala startup options. See
        <a class="xref" href="impala_ports.html#ports">Ports Used by Impala</a> for information about all ports used for communication between Impala
        and clients or between Impala components.
      </p>
    </div>
  </article>

  <article class="topic concept nested1" aria-labelledby="ariaid-title3" id="impala_jdbc__jdbc_driver_choice">

    <h2 class="title topictitle2" id="ariaid-title3">Choosing the JDBC Driver</h2>
  

    <div class="body conbody">

      <p class="p">
        In Impala 2.0 and later, you can use the Hive 0.13 JDBC driver.  If you are
        already using JDBC applications with an earlier Impala release, you should update
        your JDBC driver, because the Hive 0.12 driver that was formerly the only choice
        is not compatible with Impala 2.0 and later.
      </p>

      <p class="p">
        The Hive JDBC driver provides a substantial speed increase for JDBC
        applications with Impala 2.0 and higher, for queries that return large result sets.
      </p>

      <p class="p">
        <strong class="ph b">Complex type considerations:</strong>
      </p>

      <p class="p">
        The Impala complex types (<code class="ph codeph">STRUCT</code>, <code class="ph codeph">ARRAY</code>, or <code class="ph codeph">MAP</code>)
        are available in <span class="keyword">Impala 2.3</span> and higher.
        To use these types with JDBC requires version 2.5.28 or higher of the JDBC Connector for Impala.
        To use these types with ODBC requires version 2.5.30 or higher of the ODBC Connector for Impala.
        Consider upgrading all JDBC and ODBC drivers at the same time you upgrade from <span class="keyword">Impala 2.3</span> or higher.
      </p>
      <p class="p">
        Although the result sets from queries involving complex types consist of all scalar values,
        the queries involve join notation and column references that might not be understood by
        a particular JDBC or ODBC connector. Consider defining a view that represents the
        flattened version of a table containing complex type columns, and pointing the JDBC
        or ODBC application at the view.
        See <a class="xref" href="../shared/../topics/impala_complex_types.html#complex_types">Complex Types (Impala 2.3 or higher only)</a> for details.
      </p>

    </div>
  </article>

  <article class="topic concept nested1" aria-labelledby="ariaid-title4" id="impala_jdbc__jdbc_setup">

    <h2 class="title topictitle2" id="ariaid-title4">Enabling Impala JDBC Support on Client Systems</h2>
  

    <div class="body conbody">

      <section class="section" id="jdbc_setup__install_hive_driver"><h3 class="title sectiontitle">Using the Hive JDBC Driver</h3>
        
        <p class="p">
          You install the Hive JDBC driver (<code class="ph codeph">hive-jdbc</code> package) through the Linux package manager, on
          hosts within the cluster. The driver consists of several Java JAR files. The same driver can be used by Impala and Hive.
        </p>

        <p class="p">
          To get the JAR files, install the Hive JDBC driver on each host in the cluster that will run
          JDBC applications. 
        </p>

        <div class="note note note_note"><span class="note__title notetitle">Note:</span> 
          The latest JDBC driver, corresponding to Hive 0.13, provides substantial performance improvements for
          Impala queries that return large result sets. Impala 2.0 and later are compatible with the Hive 0.13
          driver. If you already have an older JDBC driver installed, and are running Impala 2.0 or higher, consider
          upgrading to the latest Hive JDBC driver for best performance with JDBC applications.
        </div>

        <p class="p">
          If you are using JDBC-enabled applications on hosts outside the cluster, you cannot use the the same install
          procedure on the hosts. Install the JDBC driver on at least one cluster host using the preceding
          procedure. Then download the JAR files to each client machine that will use JDBC with Impala:
        </p>

  <pre class="pre codeblock"><code>commons-logging-X.X.X.jar
  hadoop-common.jar
  hive-common-X.XX.X.jar
  hive-jdbc-X.XX.X.jar
  hive-metastore-X.XX.X.jar
  hive-service-X.XX.X.jar
  httpclient-X.X.X.jar
  httpcore-X.X.X.jar
  libfb303-X.X.X.jar
  libthrift-X.X.X.jar
  log4j-X.X.XX.jar
  slf4j-api-X.X.X.jar
  slf4j-logXjXX-X.X.X.jar
  </code></pre>

        <p class="p">
          <strong class="ph b">To enable JDBC support for Impala on the system where you run the JDBC application:</strong>
        </p>

        <ol class="ol">
          <li class="li">
            Download the JAR files listed above to each client machine.
            <div class="note note note_note"><span class="note__title notetitle">Note:</span> 
              For Maven users, see
              <a class="xref" href="https://github.com/onefoursix/Cloudera-Impala-JDBC-Example" target="_blank">this sample github page</a> for an example of the
              dependencies you could add to a <code class="ph codeph">pom</code> file instead of downloading the individual JARs.
            </div>
          </li>

          <li class="li">
            Store the JAR files in a location of your choosing, ideally a directory already referenced in your
            <code class="ph codeph">CLASSPATH</code> setting. For example:
            <ul class="ul">
              <li class="li">
                On Linux, you might use a location such as <code class="ph codeph">/opt/jars/</code>.
              </li>

              <li class="li">
                On Windows, you might use a subdirectory underneath <span class="ph filepath">C:\Program Files</span>.
              </li>
            </ul>
          </li>

          <li class="li">
            To successfully load the Impala JDBC driver, client programs must be able to locate the associated JAR
            files. This often means setting the <code class="ph codeph">CLASSPATH</code> for the client process to include the
            JARs. Consult the documentation for your JDBC client for more details on how to install new JDBC drivers,
            but some examples of how to set <code class="ph codeph">CLASSPATH</code> variables include:
            <ul class="ul">
              <li class="li">
                On Linux, if you extracted the JARs to <code class="ph codeph">/opt/jars/</code>, you might issue the following
                command to prepend the JAR files path to an existing classpath:
  <pre class="pre codeblock"><code>export CLASSPATH=/opt/jars/*.jar:$CLASSPATH</code></pre>
              </li>

              <li class="li">
                On Windows, use the <strong class="ph b">System Properties</strong> control panel item to modify the <strong class="ph b">Environment
                Variables</strong> for your system. Modify the environment variables to include the path to which you
                extracted the files.
                <div class="note note note_note"><span class="note__title notetitle">Note:</span> 
                  If the existing <code class="ph codeph">CLASSPATH</code> on your client machine refers to some older version of
                  the Hive JARs, ensure that the new JARs are the first ones listed. Either put the new JAR files
                  earlier in the listings, or delete the other references to Hive JAR files.
                </div>
              </li>
            </ul>
          </li>
        </ol>
      </section>

    </div>
  </article>

  <article class="topic concept nested1" aria-labelledby="ariaid-title5" id="impala_jdbc__jdbc_connect">

    <h2 class="title topictitle2" id="ariaid-title5">Establishing JDBC Connections</h2>

    <div class="body conbody">

      <p class="p">
        The JDBC driver class depends on which driver you select.
      </p>

      <div class="note note note_note"><span class="note__title notetitle">Note:</span> 
        If your JDBC or ODBC application connects to Impala through a load balancer such as
        <code class="ph codeph">haproxy</code>, be cautious about reusing the connections. If the load balancer has set up
        connection timeout values, either check the connection frequently so that it never sits idle longer than
        the load balancer timeout value, or check the connection validity before using it and create a new one if
        the connection has been closed.
      </div>

      <section class="section" id="jdbc_connect__class_hive_driver"><h3 class="title sectiontitle">Using the Hive JDBC Driver</h3>
      

      <p class="p">
        For example, with the Hive JDBC driver, the class name is <code class="ph codeph">org.apache.hive.jdbc.HiveDriver</code>.
        Once you have configured Impala to work with JDBC, you can establish connections between the two.
        To do so for a cluster that does not use
        Kerberos authentication, use a connection string of the form
        <code class="ph codeph">jdbc:hive2://<var class="keyword varname">host</var>:<var class="keyword varname">port</var>/;auth=noSasl</code>.

        For example, you might use:
      </p>

<pre class="pre codeblock"><code>jdbc:hive2://myhost.example.com:21050/;auth=noSasl</code></pre>

      <p class="p">
        To connect to an instance of Impala that requires Kerberos authentication, use a connection string of the
        form
        <code class="ph codeph">jdbc:hive2://<var class="keyword varname">host</var>:<var class="keyword varname">port</var>/;principal=<var class="keyword varname">principal_name</var></code>.
        The principal must be the same user principal you used when starting Impala. For example, you might use:
      </p>

<pre class="pre codeblock"><code>jdbc:hive2://myhost.example.com:21050/;principal=impala/myhost.example.com@H2.EXAMPLE.COM</code></pre>

      <p class="p">
        To connect to an instance of Impala that requires LDAP authentication, use a connection string of the form
        <code class="ph codeph">jdbc:hive2://<var class="keyword varname">host</var>:<var class="keyword varname">port</var>/<var class="keyword varname">db_name</var>;user=<var class="keyword varname">ldap_userid</var>;password=<var class="keyword varname">ldap_password</var></code>.
        For example, you might use:
      </p>

<pre class="pre codeblock"><code>jdbc:hive2://myhost.example.com:21050/test_db;user=fred;password=xyz123</code></pre>

      <div class="note note note_note"><span class="note__title notetitle">Note:</span> 
          <p class="p">
        Prior to <span class="keyword">Impala 2.5</span>, the Hive JDBC driver did not support connections that use both Kerberos authentication
        and SSL encryption. If your cluster is running an older release that has this restriction,
        use an alternative JDBC driver that supports
        both of these security features.
      </p>
      </div>

      </section>

    </div>
  </article>

  <article class="topic concept nested1" aria-labelledby="ariaid-title6" id="impala_jdbc__jdbc_odbc_notes">
    <h2 class="title topictitle2" id="ariaid-title6">Notes about JDBC and ODBC Interaction with Impala SQL Features</h2>
    <div class="body conbody">
      <p class="p">
        Most Impala SQL features work equivalently through the <span class="keyword cmdname">impala-shell</span> interpreter
        of the JDBC or ODBC APIs. The following are some exceptions to keep in mind when switching between
        the interactive shell and applications using the APIs:
      </p>
      <ul class="ul">
        <li class="li">
          <p class="p">
        <strong class="ph b">Complex type considerations:</strong>
      </p>
          <ul class="ul">
          <li class="li">
          <p class="p">
            Queries involving the complex types (<code class="ph codeph">ARRAY</code>, <code class="ph codeph">STRUCT</code>, and <code class="ph codeph">MAP</code>)
            require notation that might not be available in all levels of JDBC and ODBC drivers.
            If you have trouble querying such a table due to the driver level or
            inability to edit the queries used by the application, you can create a view that exposes
            a <span class="q">"flattened"</span> version of the complex columns and point the application at the view.
            See <a class="xref" href="impala_complex_types.html#complex_types">Complex Types (Impala 2.3 or higher only)</a> for details.
          </p>
        </li>
        <li class="li">
          <p class="p">
            The complex types available in <span class="keyword">Impala 2.3</span> and higher are supported by the
            JDBC <code class="ph codeph">getColumns()</code> API.
            Both <code class="ph codeph">MAP</code> and <code class="ph codeph">ARRAY</code> are reported as the JDBC SQL Type <code class="ph codeph">ARRAY</code>,
            because this is the closest matching Java SQL type. This behavior is consistent with Hive.
            <code class="ph codeph">STRUCT</code> types are reported as the JDBC SQL Type <code class="ph codeph">STRUCT</code>.
          </p>
          <div class="p">
            To be consistent with Hive's behavior, the TYPE_NAME field is populated
            with the primitive type name for scalar types, and with the full <code class="ph codeph">toSql()</code>
            for complex types. The resulting type names are somewhat inconsistent,
            because nested types are printed differently than top-level types. For example,
            the following list shows how <code class="ph codeph">toSQL()</code> for Impala types are
            translated to <code class="ph codeph">TYPE_NAME</code> values:
<pre class="pre codeblock"><code>DECIMAL(10,10)         becomes  DECIMAL
CHAR(10)               becomes  CHAR
VARCHAR(10)            becomes  VARCHAR
ARRAY&lt;DECIMAL(10,10)&gt;  becomes  ARRAY&lt;DECIMAL(10,10)&gt;
ARRAY&lt;CHAR(10)&gt;        becomes  ARRAY&lt;CHAR(10)&gt;
ARRAY&lt;VARCHAR(10)&gt;     becomes  ARRAY&lt;VARCHAR(10)&gt;

</code></pre>
          </div>
          </li>
        </ul>
        </li>
      </ul>
    </div>
  </article>

  <article class="topic concept nested1" aria-labelledby="ariaid-title7" id="impala_jdbc__jdbc_kudu">
    <h2 class="title topictitle2" id="ariaid-title7">Kudu Considerations for DML Statements</h2>
    <div class="body conbody">
      <p class="p">
        Currently, Impala <code class="ph codeph">INSERT</code>, <code class="ph codeph">UPDATE</code>, or
        other DML statements issued through the JDBC interface against a Kudu
        table do not return JDBC error codes for conditions such as duplicate
        primary key columns. Therefore, for applications that issue a high
        volume of DML statements, prefer to use the Kudu Java API directly
        rather than a JDBC application.
      </p>
    </div>
  </article>

</article></main></body></html>