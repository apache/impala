<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2019" />
<meta name="DC.rights.owner" content="(C) Copyright 2019" />
<meta name="DC.Type" content="concept" />
<meta name="DC.Title" content="APPX_MEDIAN Function" />
<meta name="DC.Relation" scheme="URI" content="../topics/impala_aggregate_functions.html" />
<meta name="prodname" content="Impala" />
<meta name="prodname" content="Impala" />
<meta name="version" content="Impala 3.2.x" />
<meta name="version" content="Impala 3.2.x" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="appx_median" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>APPX_MEDIAN Function</title>
</head>
<body id="appx_median">


  <h1 class="title topictitle1" id="ariaid-title1">APPX_MEDIAN Function</h1>

  
  

  <div class="body conbody">

    <p class="p">
      
      An aggregate function that returns a value that is approximately the median (midpoint) of values in the set
      of input values.
    </p>


    <p class="p">
        <strong class="ph b">Syntax:</strong>
      </p>


<pre class="pre codeblock"><code>APPX_MEDIAN([DISTINCT | ALL] <var class="keyword varname">expression</var>)
</code></pre>

    <p class="p">
      This function works with any input type, because the only requirement is that the type supports less-than and
      greater-than comparison operators.
    </p>


    <p class="p">
        <strong class="ph b">Usage notes:</strong>
      </p>


    <p class="p">
      Because the return value represents the estimated midpoint, it might not reflect the precise midpoint value,
      especially if the cardinality of the input values is very high. If the cardinality is low (up to
      approximately 20,000), the result is more accurate because the sampling considers all or almost all of the
      different values.
    </p>


    <p class="p">
        <strong class="ph b">Return type:</strong> Same as the input value, except for <code class="ph codeph">CHAR</code> and <code class="ph codeph">VARCHAR</code>
        arguments which produce a <code class="ph codeph">STRING</code> result
      </p>


    <p class="p">
      The return value is always the same as one of the input values, not an <span class="q">"in-between"</span> value produced by
      averaging.
    </p>




    <p class="p">
        <strong class="ph b">Restrictions:</strong>
      </p>


    <p class="p">
        This function cannot be used in an analytic context. That is, the <code class="ph codeph">OVER()</code> clause is not allowed at all with this function.
      </p>


    <p class="p">
      The <code class="ph codeph">APPX_MEDIAN</code> function returns only the first 10 characters for
      string values (string, varchar, char). Additional characters are truncated.
    </p>


     <p class="p">
        <strong class="ph b">Examples:</strong>
      </p>


    <p class="p">
      The following example uses a table of a million random floating-point numbers ranging up to approximately
      50,000. The average is approximately 25,000. Because of the random distribution, we would expect the median
      to be close to this same number. Computing the precise median is a more intensive operation than computing
      the average, because it requires keeping track of every distinct value and how many times each occurs. The
      <code class="ph codeph">APPX_MEDIAN()</code> function uses a sampling algorithm to return an approximate result, which in
      this case is close to the expected value. To make sure that the value is not substantially out of range due
      to a skewed distribution, subsequent queries confirm that there are approximately 500,000 values higher than
      the <code class="ph codeph">APPX_MEDIAN()</code> value, and approximately 500,000 values lower than the
      <code class="ph codeph">APPX_MEDIAN()</code> value.
    </p>


<pre class="pre codeblock"><code>[localhost:21000] &gt; select min(x), max(x), avg(x) from million_numbers;
+-------------------+-------------------+-------------------+
| min(x)            | max(x)            | avg(x)            |
+-------------------+-------------------+-------------------+
| 4.725693727250069 | 49994.56852674231 | 24945.38563793553 |
+-------------------+-------------------+-------------------+
[localhost:21000] &gt; select appx_median(x) from million_numbers;
+----------------+
| appx_median(x) |
+----------------+
| 24721.6        |
+----------------+
[localhost:21000] &gt; select count(x) as higher from million_numbers where x &gt; (select appx_median(x) from million_numbers);
+--------+
| higher |
+--------+
| 502013 |
+--------+
[localhost:21000] &gt; select count(x) as lower from million_numbers where x &lt; (select appx_median(x) from million_numbers);
+--------+
| lower  |
+--------+
| 497987 |
+--------+
</code></pre>

    <p class="p">
      The following example computes the approximate median using a subset of the values from the table, and then
      confirms that the result is a reasonable estimate for the midpoint.
    </p>


<pre class="pre codeblock"><code>[localhost:21000] &gt; select appx_median(x) from million_numbers where x between 1000 and 5000;
+-------------------+
| appx_median(x)    |
+-------------------+
| 3013.107787358159 |
+-------------------+
[localhost:21000] &gt; select count(x) as higher from million_numbers where x between 1000 and 5000 and x &gt; 3013.107787358159;
+--------+
| higher |
+--------+
| 37692  |
+--------+
[localhost:21000] &gt; select count(x) as lower from million_numbers where x between 1000 and 5000 and x &lt; 3013.107787358159;
+-------+
| lower |
+-------+
| 37089 |
+-------+
</code></pre>
  </div>

<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../topics/impala_aggregate_functions.html">Impala Aggregate Functions</a></div>
</div>
</div></body>
</html>