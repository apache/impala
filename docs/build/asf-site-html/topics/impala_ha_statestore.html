<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2025"><meta name="DC.rights.owner" content="(C) Copyright 2025"><meta name="DC.Type" content="concept"><meta name="DC.Relation" scheme="URI" content="../topics/impala_ha.html"><meta name="prodname" content="Impala"><meta name="version" content="Impala 3.4.x"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="impala_ha_statestore"><link rel="stylesheet" type="text/css" href="../css/commonltr.css"><link rel="stylesheet" type="text/css" href="../css/dita-ot-doc.css"><title>Configuring StateStore for High Availability</title></head><body id="impala_ha_statestore"><header role="banner"><!--
The DITA Open Toolkit is licensed for use under the the Apache
Software Foundation License v2.0.

A copy of the Apache Software Foundation License 2.0 is
available at http://opensource.org/licenses/apache2.0.php

This statement must be included in any copies of DITA Open
Toolkit code.
--><div class="header">
  <p>Apache Impala</p>
  <hr>
</div></header><nav role="toc"><ul><li><a href="../topics/impala_intro.html">Introducing Apache Impala</a></li><li><a href="../topics/impala_concepts.html">Concepts and Architecture</a></li><li><a href="../topics/impala_planning.html">Deployment Planning</a></li><li><a href="../topics/impala_install.html">Installing Impala</a></li><li><a href="../topics/impala_config.html">Managing Impala</a></li><li><a href="../topics/impala_upgrading.html">Upgrading Impala</a></li><li><a href="../topics/impala_processes.html">Starting Impala</a></li><li><a href="../topics/impala_tutorial.html">Tutorials</a></li><li><a href="../topics/impala_admin.html">Administration</a><ul><li><a href="../topics/impala_timeouts.html">Setting Timeouts</a></li><li><a href="../topics/impala_ha.html">Configuring Impala for High Availability</a><ul><li class="active"><a href="../topics/impala_ha_statestore.html">Configuring StateStore for High Availability</a></li><li><a href="../topics/impala_ha_catalog.html">Configuring Catalog for High Availability</a></li></ul></li><li><a href="../topics/impala_proxy.html">Load-Balancing Proxy for HA</a></li><li><a href="../topics/impala_disk_space.html">Managing Disk Space</a></li></ul></li><li><a href="../topics/impala_security.html">Impala Security</a></li><li><a href="../topics/impala_langref.html">SQL Reference</a></li><li><a href="../topics/impala_performance.html">Performance Tuning</a></li><li><a href="../topics/impala_scalability.html">Scalability Considerations</a></li><li><a href="../topics/impala_resource_management.html">Resource Management</a></li><li><a href="../topics/impala_partitioning.html">Partitioning</a></li><li><a href="../topics/impala_file_formats.html">File Formats</a></li><li><a href="../topics/impala_jdbc_external_table.html">Using Impala to Query External JDBC Data Sources</a></li><li><a href="../topics/impala_kudu.html">Using Impala to Query Kudu Tables</a></li><li><a href="../topics/impala_hbase.html">HBase Tables</a></li><li><a href="../topics/impala_iceberg.html">Iceberg Tables</a></li><li><a href="../topics/impala_s3.html">S3 Tables</a></li><li><a href="../topics/impala_adls.html">ADLS Tables</a></li><li><a href="../topics/impala_isilon.html">Isilon Storage</a></li><li><a href="../topics/impala_ozone.html">Ozone Storage</a></li><li><a href="../topics/impala_logging.html">Logging</a></li><li><a href="../topics/impala_client.html">Client Access</a></li><li><a href="../topics/impala_fault_tolerance.html">Fault Tolerance</a></li><li><a href="../topics/impala_troubleshooting.html">Troubleshooting Impala</a></li><li><a href="../topics/impala_ports.html">Ports Used by Impala</a></li><li><a href="../topics/impala_reserved_words.html">Impala Reserved Words</a></li><li><a href="../topics/impala_faq.html">Impala Frequently Asked Questions</a></li><li><a href="../topics/impala_release_notes.html">Impala Release Notes</a></li></ul></nav><main role="main"><article role="article" aria-labelledby="ariaid-title1">
  <h1 class="title topictitle1" id="ariaid-title1">Configuring StateStore for High Availability</h1>
  
  <div class="body conbody">
    <p class="p">With a pair of StateStore instances in primary/standby mode, the primary StateStore instance
      will send the cluster's state update and propagate metadata updates. It periodically sends
      heartbeat to the standby StateStore instance, CatalogD, coordinators and executors. The standby
      StateStore instance also sends heartbeats to the CatalogD, and coordinators and executors. RPC
      connections between daemons and StateStore instances are kept alive so that broken connections
      usually won't result in false failure reports between nodes. The standby StateStore instance
      takes over the primary role when the service is needed in order to continue to operate when
      the primary instance goes down.</p>
  </div>
  <nav role="navigation" class="related-links"><div class="familylinks"><div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../topics/impala_ha.html">Configuring Impala for High Availability</a></div></div></nav><article class="topic concept nested1" aria-labelledby="ariaid-title2" id="impala_ha_statestore__enabling_statestore_ha">
    <h2 class="title topictitle2" id="ariaid-title2">Enabling StateStore High Availability</h2>
    <div class="body conbody">
      <div class="p">To enable StateStore High Availability (HA) in an Impala cluster, follow these steps:<ol class="ol" id="enabling_statestore_ha__ol_k2p_zxm_1cc">
        <li class="li">Restart two StateStore instances with the following additional
          flags:<pre class="pre codeblock" id="enabling_statestore_ha__codeblock_tmp_bym_1cc"><code>enable_statestored_ha: true
state_store_ha_port: RPC port for StateStore HA service (default: 24020)
state_store_peer_host: Hostname of the peer StateStore instance
state_store_peer_ha_port: RPC port of high availability service on the peer StateStore instance (default: 24020)
</code></pre></li>
        <li class="li">Restart all subscribers (including CatalogD, coordinators, and executors) with the
            following additional
            flags:<pre class="pre codeblock" id="enabling_statestore_ha__codeblock_zyl_lmh_fcc"><code>state_store_host: Hostname of the first StateStore instance
state_store_port: RPC port for StateStore registration on the first StateStore instance (default: 24000)
enable_statestored_ha: true
state_store_2_host: Hostname of the second StateStore instance
state_store_2_port: RPC port for StateStore registration on the second StateStore instance (default: 24000)</code></pre></li>
      </ol></div>
    <p class="p">By setting these flags, the Impala cluster is configured to use two StateStore instances for
      high availability, ensuring high availability and fault tolerance.</p>
    </div>
  </article>
  <article class="topic concept nested1" aria-labelledby="ariaid-title3" id="impala_ha_statestore__disabling_statestore_ha">
    <h2 class="title topictitle2" id="ariaid-title3">Disabling StateStore High Availability</h2>
    <div class="body conbody">
      <div class="p">To disable StateStore high availability in an Impala cluster, follow these steps:<ol class="ol" id="disabling_statestore_ha__ol_udj_b1n_1cc">
          <li class="li">Remove one StateStore instance from the Impala cluster.</li>
          <li class="li">Restart the remaining StateStore instance along with the coordinator, executor, and
            CatalogD nodes, ensuring they are restarted without the
              <code class="ph codeph">enable_statestored_ha</code> flag.</li>
        </ol></div>
    </div>
  </article>
  <article class="topic concept nested1" aria-labelledby="ariaid-title4" id="impala_ha_statestore__statestore_failure_detection">
    <h2 class="title topictitle2" id="ariaid-title4">StateStore Failure Detection</h2>
    <div class="body conbody">
      <p class="p">The primary StateStore instance continuously sends heartbeat to its registered clients, and
        the standby StateStore instance. Each StateStore client registers to both active and standby
        StateStore instances, and maintains the following information about the StateStore servers:
        the server IP and port, service role - primary/standby, the last time the heartbeat request
        was received, or number of missed heartbeats. A missing heartbeat response from the
        StateStorâ€™s client indicates an unhealthy daemon. There is a flag that defines
          <code class="ph codeph">MAX_MISSED_HEARTBEAT_REQUEST_NUM </code>as the consecutive number of missed
        heartbeat requests to indicate losing communication with the StateStore server from the
        client's point of view so that the client marks the StateStore server as down. Standby
        StateStore instance collects the connection states between the clients (CatalogD,
        coordinators and executors) and primary StateStore instance in its heartbeat messages to the
        clients. If the standby StateStore instance misses <code class="ph codeph">MAX_MISSED_HEARTBEAT_REQUEST_NUM
        </code>of heartbeat requests from the primary StateStore instance and the majority of
        clients lose connections with the primary StateStore, it takes over the primary role.</p>
    </div>
  </article>
</article></main></body></html>