<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2025"><meta name="DC.rights.owner" content="(C) Copyright 2025"><meta name="DC.Type" content="concept"><meta name="DC.Relation" scheme="URI" content="../topics/impala_complex_types.html"><meta name="prodname" content="Impala"><meta name="version" content="Impala 3.4.x"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="impala_queryingarrays"><link rel="stylesheet" type="text/css" href="../css/commonltr.css"><link rel="stylesheet" type="text/css" href="../css/dita-ot-doc.css"><title>Querying arrays (Impala 4.1 or higher only)</title></head><body id="impala_queryingarrays"><header role="banner"><!--
The DITA Open Toolkit is licensed for use under the the Apache
Software Foundation License v2.0.

A copy of the Apache Software Foundation License 2.0 is
available at http://opensource.org/licenses/apache2.0.php

This statement must be included in any copies of DITA Open
Toolkit code.
--><div class="header">
  <p>Apache Impala</p>
  <hr>
</div></header><nav role="toc"><ul><li><a href="../topics/impala_intro.html">Introducing Apache Impala</a></li><li><a href="../topics/impala_concepts.html">Concepts and Architecture</a></li><li><a href="../topics/impala_planning.html">Deployment Planning</a></li><li><a href="../topics/impala_install.html">Installing Impala</a></li><li><a href="../topics/impala_config.html">Managing Impala</a></li><li><a href="../topics/impala_upgrading.html">Upgrading Impala</a></li><li><a href="../topics/impala_processes.html">Starting Impala</a></li><li><a href="../topics/impala_tutorial.html">Tutorials</a></li><li><a href="../topics/impala_admin.html">Administration</a></li><li><a href="../topics/impala_security.html">Impala Security</a></li><li><a href="../topics/impala_langref.html">SQL Reference</a><ul><li><a href="../topics/impala_comments.html">Comments</a></li><li><a href="../topics/impala_datatypes.html">Data Types</a><ul><li><a href="../topics/impala_array.html">ARRAY Complex Type (Impala 2.3 or higher only)</a></li><li><a href="../topics/impala_bigint.html">BIGINT</a></li><li><a href="../topics/impala_boolean.html">BOOLEAN</a></li><li><a href="../topics/impala_char.html">CHAR</a></li><li><a href="../topics/impala_date.html">DATE</a></li><li><a href="../topics/impala_decimal.html">DECIMAL</a></li><li><a href="../topics/impala_double.html">DOUBLE</a></li><li><a href="../topics/impala_float.html">FLOAT</a></li><li><a href="../topics/impala_int.html">INT</a></li><li><a href="../topics/impala_map.html">MAP Complex Type (Impala 2.3 or higher only)</a></li><li><a href="../topics/impala_real.html">REAL</a></li><li><a href="../topics/impala_smallint.html">SMALLINT</a></li><li><a href="../topics/impala_string.html">STRING</a></li><li><a href="../topics/impala_struct.html">STRUCT Complex Type (Impala 2.3 or higher only)</a></li><li><a href="../topics/impala_timestamp.html">TIMESTAMP</a></li><li><a href="../topics/impala_tinyint.html">TINYINT</a></li><li><a href="../topics/impala_varchar.html">VARCHAR</a></li><li><a href="../topics/impala_complex_types.html">Complex Types (Impala 2.3 or higher only)</a><ul><li class="active"><a href="../topics/impala_queryingarrays.html">Querying arrays</a></li><li><a href="../topics/impala_unnest_views.html">Zipping unnest on arrays from views</a></li></ul></li></ul></li><li><a href="../topics/impala_literals.html">Literals</a></li><li><a href="../topics/impala_operators.html">SQL Operators</a></li><li><a href="../topics/impala_schema_objects.html">Schema Objects and Object Names</a></li><li><a href="../topics/impala_transactions.html">Transactions</a></li><li><a href="../topics/impala_langref_sql.html">SQL Statements</a></li><li><a href="../topics/impala_functions.html">Built-In Functions</a></li><li><a href="../topics/impala_udf.html">User-Defined Functions (UDFs)</a></li><li><a href="../topics/impala_langref_unsupported.html">SQL Differences Between Impala and Hive</a></li><li><a href="../topics/impala_porting.html">Porting SQL</a></li><li><a href="../topics/impala_utf_8.html">UTF-8 Support</a></li></ul></li><li><a href="../topics/impala_performance.html">Performance Tuning</a></li><li><a href="../topics/impala_scalability.html">Scalability Considerations</a></li><li><a href="../topics/impala_resource_management.html">Resource Management</a></li><li><a href="../topics/impala_partitioning.html">Partitioning</a></li><li><a href="../topics/impala_file_formats.html">File Formats</a></li><li><a href="../topics/impala_jdbc_external_table.html">Using Impala to Query External JDBC Data Sources</a></li><li><a href="../topics/impala_kudu.html">Using Impala to Query Kudu Tables</a></li><li><a href="../topics/impala_hbase.html">HBase Tables</a></li><li><a href="../topics/impala_iceberg.html">Iceberg Tables</a></li><li><a href="../topics/impala_s3.html">S3 Tables</a></li><li><a href="../topics/impala_adls.html">ADLS Tables</a></li><li><a href="../topics/impala_isilon.html">Isilon Storage</a></li><li><a href="../topics/impala_ozone.html">Ozone Storage</a></li><li><a href="../topics/impala_logging.html">Logging</a></li><li><a href="../topics/impala_client.html">Client Access</a></li><li><a href="../topics/impala_fault_tolerance.html">Fault Tolerance</a></li><li><a href="../topics/impala_troubleshooting.html">Troubleshooting Impala</a></li><li><a href="../topics/impala_ports.html">Ports Used by Impala</a></li><li><a href="../topics/impala_reserved_words.html">Impala Reserved Words</a></li><li><a href="../topics/impala_faq.html">Impala Frequently Asked Questions</a></li><li><a href="../topics/impala_release_notes.html">Impala Release Notes</a></li></ul></nav><main role="main"><article role="article" aria-labelledby="ariaid-title1">
  <h1 class="title topictitle1" id="ariaid-title1">Querying arrays (<span class="keyword">Impala 4.1</span> or higher only)</h1>
  
  
  <div class="body conbody">
    <p class="p">
       Describes how to use UNNEST function
      to query arrays. ARRAY data types represent collections with arbitrary numbers of elements,
      where each element is the same type.</p>
    <section class="section" id="impala_queryingarrays__section_yl4_2qb_3cc"><h2 class="title sectiontitle">Querying arrays using JOIN and UNNEST</h2>
      
      <p class="p">You can query arrays by making a join between the table and the array inside the table.
        This approach is improved with the introduction of the <code class="ph codeph">UNNEST</code> function in
        the <code class="ph codeph">SELECT</code> list or in the <code class="ph codeph">FROM</code> clause in the
          <code class="ph codeph">SELECT</code> statement. When you use <code class="ph codeph">UNNEST</code>, you can provide
        more than one array in the <code class="ph codeph">SELECT</code> statement. If you use JOINs for querying
        arrays it will yield a <dfn class="term">joining unnest</dfn> however the latter will provide a
          <dfn class="term">zipping unnest</dfn>.</p>
    </section>
    <section class="section" id="impala_queryingarrays__section_hmf_hqb_3cc"><h2 class="title sectiontitle">Example of querying arrays using JOIN</h2>
      
      <p class="p">Use <code class="ph codeph">JOIN</code> in cases where you must join unnest of multiple arrays. However
        if you must zip unnest then use the newly implemented <code class="ph codeph">UNNEST</code> function.</p>
      <p class="p">Here is an example of a <code class="ph codeph">SELECT</code> statement that uses JOINs to query an
        array.</p>
      <pre class="pre codeblock" id="impala_queryingarrays__codeblock_uqy_rqb_3cc"><code>SELECT id, arr1.item, arr2.item FROM tbl_name tbl, tbl.arr1, tbl.arr2;

ID, ARR1.ITEM, ARR2.ITEM
[1, 1, 10]
[1, 1, 11]
[1, 2, 10]
[1, 2, 11]
[1, 3, 10]
[1, 3, 11]
</code></pre>
      <div class="note note note_note" id="impala_queryingarrays__note_tpb_wln_htb"><span class="note__title notetitle">Note:</span> 
        <p class="p">The test data used in this example is ID: 1, arr1: {1, 2, 3}, arr2: {10, 11}</p>
      </div>
    </section>
    <section class="section" id="impala_queryingarrays__section_ipq_tqb_3cc"><h2 class="title sectiontitle">Examples of querying arrays using UNNEST</h2>
      
      <p class="p">You can use one of the two different syntaxes shown here to unnest multiple arrays in one
        query. This results in the items of the arrays being zipped together instead of joining.</p>
      <ul class="ul" id="impala_queryingarrays__ul_jpq_tqb_3cc">
        <li class="li">ISO:SQL 2016 compliant syntax:
          <pre class="pre codeblock" id="impala_queryingarrays__codeblock_kpq_tqb_3cc"><code>SELECT a1.item, a2.item
FROM complextypes_arrays t, UNNEST(t.arr1, t.arr2) AS (a1, a2);
</code></pre></li>
        <li class="li">Postgres compatible
          syntax:<pre class="pre codeblock" id="impala_queryingarrays__codeblock_yl5_3mn_htb"><code>SELECT UNNEST(arr1), UNNEST(arr2) FROM complextypes_arrays;</code></pre></li>
      </ul>
      <p class="p"><strong class="ph b">Unnest operator in SELECT list</strong></p>
      <pre class="pre codeblock" id="impala_queryingarrays__codeblock_lpq_tqb_3cc"><code>SELECT id, unnest(arr1), unnest(arr2) FROM tbl_name;</code></pre>
      <p class="p"><strong class="ph b">Unnest operator in FROM clause</strong></p>
      <pre class="pre codeblock" id="impala_queryingarrays__codeblock_mpq_tqb_3cc"><code>SELECT id, arr1.item, arr2.item FROM tbl_name tbl_alias, UNNEST(tbl_alias.arr1, tbl_alias.arr2);</code></pre>
      <p class="p">This new functionality would zip the arrays next to each other as shown here. </p>
      <pre class="pre codeblock" id="impala_queryingarrays__codeblock_npq_tqb_3cc"><code>ID, ARR1.ITEM, ARR2.ITEM
[1, 1, 10]
[1, 2, 11]
[1, 3, NULL]
</code></pre>
      <p class="p">Note, that arr2 is shorter than arr1 so the "missing" items in its column will be filled
        with NULLs.</p>
      <div class="note note note_note" id="impala_queryingarrays__note_opq_tqb_3cc"><span class="note__title notetitle">Note:</span> The test data used in this example is ID: 1, arr1: {1, 2, 3},
        arr2: {10, 11}</div>
    </section>
    <section class="section" id="impala_queryingarrays__section_i1g_wqb_3cc"><h2 class="title sectiontitle">Limitations in Using UNNEST</h2>
      
      <div class="p">
        <ul class="ul" id="impala_queryingarrays__ul_j1g_wqb_3cc">
          <li class="li">Only arrays from the same table can be zipping unnested</li>
          <li class="li">The old (joining) and the new (zipping) unnests cannot be used together</li>
          <li class="li">You can add a <code class="ph codeph">WHERE</code> filter on an unnested item only if you add a
            wrapper <code class="ph codeph">SELECT</code> and do the filtering
            <p class="p">Example:</p><pre class="pre codeblock" id="impala_queryingarrays__codeblock_k1g_wqb_3cc"><code>SELECT id, arr1_unnest FROM (SELECT id, unnest(arr1) as arr1_unnest FROM tbl_name) WHERE arr1_unnest &lt; 10;</code></pre></li>
        </ul>
      </div>
    </section>
    <section class="section" id="impala_queryingarrays__section_ewb_yqb_3cc"><h2 class="title sectiontitle">Using ARRAY columns in the SELECT list</h2>
      
      
      <p class="p">Impala 4.1 adds support to return <code class="ph codeph">ARRAYs</code> as
          <code class="ph codeph">STRINGs</code> (<dfn class="term">JSON arrays</dfn>) in the <code class="ph codeph">SELECT</code> list,
        for example: </p>
      <pre class="pre codeblock" id="impala_queryingarrays__codeblock_gwb_yqb_3cc"><code>select id, int_array from functional_parquet.complextypestbl where id = 1;
returns: 1, “[1,2,3]”
</code></pre>
      <p class="p">Returning <code class="ph codeph">ARRAYs</code> from inline or Hive Metastore views is also supported.
        These arrays can be used both in the select list or as relative table references.</p>
      <pre class="pre codeblock" id="impala_queryingarrays__codeblock_hwb_yqb_3cc"><code>select id, int_array from (select id, int_array from complextypestbl) s;</code></pre>
      <p class="p">Though <code class="ph codeph">STRUCTs</code> are already supported, <code class="ph codeph">ARRAYs</code> and
          <code class="ph codeph">STRUCTs</code> nested within each other are not supported yet. Using them as
        non-relative table references is also not supported yet.</p>
    </section>
  </div>
<nav role="navigation" class="related-links"><div class="familylinks"><div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../topics/impala_complex_types.html">Complex Types (Impala 2.3 or higher only)</a></div></div></nav></article></main></body></html>