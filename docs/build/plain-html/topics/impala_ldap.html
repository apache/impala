<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2024" />
<meta name="DC.rights.owner" content="(C) Copyright 2024" />
<meta name="DC.Type" content="concept" />
<meta name="DC.Title" content="Enabling LDAP Authentication for Impala" />
<meta name="DC.Relation" scheme="URI" content="../topics/impala_authentication.html" />
<meta name="prodname" content="Impala" />
<meta name="prodname" content="Impala" />
<meta name="version" content="Impala 3.4.x" />
<meta name="version" content="Impala 3.4.x" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="ldap" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Enabling LDAP Authentication for Impala</title>
</head>
<body id="ldap">


  <h1 class="title topictitle1" id="ariaid-title1">Enabling LDAP Authentication for Impala</h1>


  

  <div class="body conbody">

    <p class="p">
      Authentication is the process of allowing only specified named users to access the server
      (in this case, the Impala server). This feature is crucial for any production deployment,
      to prevent misuse, tampering, or excessive load on the server. Impala uses LDAP for
      authentication, verifying the credentials of each user who connects through
      <span class="keyword cmdname">impala-shell</span>, Hue, a Business Intelligence tool, JDBC or ODBC
      application, and so on.
    </p>


    <div class="note note"><span class="notetitle">Note:</span> 
        Regardless of the authentication mechanism used, Impala always creates HDFS directories
        and data files owned by the same user (typically <code class="ph codeph">impala</code>). To implement
        user-level access to different databases, tables, columns, partitions, and so on, use
        the Sentry authorization feature, as explained in
        <a class="xref" href="../shared/../topics/impala_authorization.html#authorization">Impala Authorization</a>.
      </div>


    <p class="p toc inpage"></p>


    <p class="p">
      An alternative form of authentication you can use is Kerberos, described in
      <a class="xref" href="impala_kerberos.html#kerberos">Enabling Kerberos Authentication for Impala</a>.
    </p>


  </div>


  <div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../topics/impala_authentication.html">Impala Authentication</a></div>
</div>
</div><div class="topic concept nested1" aria-labelledby="ariaid-title2" id="ldap_prereqs">

    <h2 class="title topictitle2" id="ariaid-title2">Requirements for Using Impala with LDAP</h2>


    

    <div class="body conbody">

      <p class="p">
        Authentication against LDAP servers is available in Impala 1.2.2 and higher. Impala
        1.4.0 adds support for secure LDAP authentication through SSL and TLS.
      </p>


      <p class="p">
        The Impala LDAP support lets you use Impala with systems such as Active Directory that
        use LDAP behind the scenes.
      </p>


    </div>


  </div>


  <div class="topic concept nested1" aria-labelledby="ariaid-title3" id="ldap_client_server">

    <h2 class="title topictitle2" id="ariaid-title3">Consideration for Connections Between Impala Components</h2>


    <div class="body conbody">

      <p class="p">
        Only client-Impala connections can be authenticated by LDAP.
      </p>


      <p class="p">
        You must use the Kerberos authentication mechanism for connections between internal
        Impala components, such as between the <span class="keyword cmdname">impalad</span>,
        <span class="keyword cmdname">statestored</span>, and <span class="keyword cmdname">catalogd</span> daemons. See
        <a class="xref" href="impala_kerberos.html#kerberos">Enabling Kerberos Authentication for Impala</a> on how to set up Kerberos for
        Impala.
      </p>


    </div>


  </div>


  <div class="topic concept nested1" aria-labelledby="ariaid-title4" id="ldap_config">

    <h2 class="title topictitle2" id="ariaid-title4">Enabling LDAP in Command Line Interface</h2>


    <div class="body conbody">

      <p class="p">
        To enable LDAP authentication, start the <span class="keyword cmdname">impalad</span> with the following
        startup options for:
      </p>


      <dl class="dl">
        

          <dt class="dt dlterm">
            <code class="ph codeph">--enable_ldap_auth</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Enables LDAP-based authentication between the client and Impala.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_uri</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Sets the URI of the LDAP server to use. Typically, the URI is prefixed with
              <code class="ph codeph">ldap://</code>. You can specify secure SSL-based LDAP transport by using
              the prefix <code class="ph codeph">ldaps://</code>. The URI can optionally specify the port, for
              example: <code class="ph codeph">ldap://ldap_server.example.com:389</code> or
              <code class="ph codeph">ldaps://ldap_server.example.com:636</code>. (389 and 636 are the default
              ports for non-SSL and SSL LDAP connections, respectively.)
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_search_bind_authentication</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Allows to switch between search and simple bind user lookup
              methods when authenticating, the default value is <code class="ph codeph">false
              </code> which is simple bind.
            </p>

          </dd>


        
      </dl>


    </div>


  </div>


  <div class="topic concept nested1" aria-labelledby="ariaid-title5" id="ldap_bind_user">

    <h2 class="title topictitle2" id="ariaid-title5">Bind User Credentials</h2>


    <div class="body conbody">

      <p class="p">
        The bind user is used to run the user/group searches, the credentials
        can be configured with the following flags:
      </p>


      <dl class="dl">
        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_allow_anonymous_binds</code>
          </dt>


          <dd class="dd">
            <p class="p">
              When true, LDAP authentication with a blank password (an
              'anonymous bind') is allowed by Impala. The default value is
              <code class="ph codeph">false</code>.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_bind_dn</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Distinguished name of the user to bind as when doing user or group
              searches. Only required if user or group filters are being used
              and the LDAP server is not configured to allow anonymous searches.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_bind_password_cmd</code>
          </dt>


          <dd class="dd">
            <p class="p">
              A Unix command whose output returns the password to use with
              <code class="ph codeph">--ldap_bind_dn</code>. The output of the command will
              be truncated to 1024 bytes and trimmed of trailing whitespace.
            </p>

          </dd>


        
      </dl>


    </div>


  </div>


  <div class="topic concept nested1" aria-labelledby="ariaid-title6" id="ldap_simple_bind">

    <h2 class="title topictitle2" id="ariaid-title6">Simple Bind User Authentication</h2>


    <div class="body conbody">

      <p class="p">
        When Impala connects to LDAP it issues a bind call to the LDAP server to authenticate as
        the connected user. Impala clients, including the Impala shell, provide the short name
        of the user to Impala. This is necessary so that Impala can use Ranger for role-based
        access, which uses short names.
      </p>


      <p class="p">
        However, LDAP servers often require more complex, structured usernames for
        authentication. Impala supports three ways of transforming the short name (for example,
        <code class="ph codeph">'henry'</code>) to a more complicated string. If necessary, specify one of the
        following configuration options when starting the <span class="keyword cmdname">impalad</span> daemon.
      </p>


      <div class="note note"><span class="notetitle">Note:</span> 
        The <code class="ph codeph">--ldap_domain</code>, <code class="ph codeph">--ldap_baseDN</code> and
        <code class="ph codeph">--ldap_bind_pattern</code> options are mutually exclusive,
        and Impala does not start if more than one of these options are
        specified.
      </div>


      <dl class="dl">
        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_domain</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Replaces the username with a string
              <code class="ph codeph"><var class="keyword varname">username</var>@<var class="keyword varname">ldap_domain</var></code>.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_baseDN</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Replaces the username with a <span class="q">"distinguished name"</span> (DN) of the form:
              <code class="ph codeph">uid=<var class="keyword varname">userid</var>,ldap_baseDN</code>. (This is equivalent to
              a Hive option).
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_bind_pattern</code>
          </dt>


          <dd class="dd">
            <p class="p">
              This is the most general option, and replaces the username with the string
              <var class="keyword varname">ldap_bind_pattern</var> where all instances of the string
              <code class="ph codeph">#UID</code> are replaced with <var class="keyword varname">userid</var>. For example, an
              <code class="ph codeph">ldap_bind_pattern</code> of <code class="ph codeph">"user=#UID,OU=foo,CN=bar"</code>
              with a username of <code class="ph codeph">henry</code> will construct a bind name of
              <code class="ph codeph">"user=henry,OU=foo,CN=bar"</code>.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_user_filter</code>
          </dt>


          <dd class="dd">
            <p class="p">
              A comma separated list of usernames. If specified, users must be
              on this list for authentication to succeed
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_group_filter</code>
          </dt>


          <dd class="dd">
            <p class="p">
              If specified, users must belong to one of these groups for
              authentication to succeed.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_group_dn_pattern</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Colon separated list of patterns for the 'distinguished name' use
              to search for groups in the directory. Each pattern may contain a
              '%s' which will be substituted with each group name from
              <code class="ph codeph">--ldap_group_filter</code> when doing group searches.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_group_membership_key</code>
          </dt>


          <dd class="dd">
            <p class="p">
              The LDAP attribute on group entries that indicates its members.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_group_class_key</code>
          </dt>


          <dd class="dd">
            <p class="p">
              The LDAP objectClass each of the groups in
              <code class="ph codeph">--ldap_group_filter</code> implements in LDAP.
            </p>

          </dd>


        
      </dl>


    </div>


  </div>


  <div class="topic concept nested1" aria-labelledby="ariaid-title7" id="ldap_search_bind">

    <h2 class="title topictitle2" id="ariaid-title7">Search Bind User Authentication</h2>


    <div class="body conbody">

      <p class="p">
        When Search Bind authentication is enabled Impala first tries to bind
        with the configured bind user, then executes an LDAP Search operation
        to find if the user exists. Once the search succeeds the DN is
        retrieved from the LDAP search results and another LDAP bind request
        is executed, this time with the connecting user to verify the password.
      </p>


      <p class="p">
        This authentication method allows to authenticate users existing in
        different LDAP subtrees when these users' parent tree is configured as
        base DN.
      </p>


      <dl class="dl">
      

        <dt class="dt dlterm">
          <code class="ph codeph">--ldap_user_search_basedn</code>
        </dt>


        <dd class="dd">
          <p class="p">
            The 'distinguished name' DN that will be used to search for the
            authenticating user, this field is required for search bind
            authentication.
          </p>

        </dd>


      

      

        <dt class="dt dlterm">
          <code class="ph codeph">--ldap_group_search_basedn</code>
        </dt>


        <dd class="dd">
          <p class="p">
            The 'distinguished name' DN that will be used to search for the
            authenticating group. If left empty, group checks will not be
            performed.
          </p>

        </dd>


      

      

        <dt class="dt dlterm">
          <code class="ph codeph">--ldap_user_filter</code>
        </dt>


        <dd class="dd">
          <p class="p">
            LDAP filter that will be used during LDAP search, it can contain
            <code class="ph codeph">{0}</code> pattern which will be replaced with the
            username. The default value is <code class="ph codeph">
            (&amp;(objectClass=user)(sAMAccountName={0}))</code>.
          </p>

        </dd>


      

      

        <dt class="dt dlterm">
          <code class="ph codeph">--ldap_group_filter</code>
        </dt>


        <dd class="dd">
          <p class="p">
            LDAP filter that will be used during LDAP group search, it can
            contain <code class="ph codeph">{1}</code> pattern which will be replaced with
            the username and/or <code class="ph codeph">{0}</code> which will be replaced
            with the user DN. The default value is <code class="ph codeph">
            (&amp;(objectClass=group)(member={0})</code>.
          </p>

          <div class="note note"><span class="notetitle">Note:</span> 
            The behaviour of this flag has been changed between Impala 4.1 and Impala 4.2
            to comply with Spring LDAP. Previously <code class="ph codeph">{0}</code> was for username
            and <code class="ph codeph">{1}</code> for user dn, these paramters were swapped, now
            <code class="ph codeph">{0}</code> is for user dn and <code class="ph codeph">{1}</code> is for username.
          </div>

        </dd>


      
      </dl>


    </div>


  </div>


  <div class="topic concept nested1" aria-labelledby="ariaid-title8" id="ldap_security">

    <h2 class="title topictitle2" id="ariaid-title8">Secure LDAP Connections</h2>


    <div class="body conbody">

      <p class="p">
        To avoid sending credentials over the wire in cleartext, you must configure a secure
        connection between both the client and Impala, and between Impala and the LDAP server.
        The secure connection could use SSL or TLS.
      </p>


      <p class="p">
        <strong class="ph b">Secure LDAP connections through SSL:</strong>
      </p>


      <p class="p">
        For SSL-enabled LDAP connections, specify a prefix of <code class="ph codeph">ldaps://</code> instead
        of <code class="ph codeph">ldap://</code>. Also, the default port for SSL-enabled LDAP connections is
        636 instead of 389.
      </p>


      <dl class="dl">
        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_passwords_in_clear_ok</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Allows LDAP passwords to be sent in the clear (without TLS/SSL)
              over the network, when set to <code class="ph codeph">true</code>. This option
              should not be used in production environments.
            </p>

          </dd>


        
      </dl>


      <p class="p">
        <strong class="ph b">Secure LDAP connections through TLS:</strong>
      </p>


      <p class="p">
        <a class="xref" href="http://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank">TLS</a>,
        the successor to the SSL protocol, is supported by most modern LDAP servers. Unlike SSL
        connections, TLS connections can be made on the same server port as non-TLS connections.
        To secure all connections using TLS, specify the following flags as startup options to
        the <span class="keyword cmdname">impalad</span> daemon.
      </p>


      <dl class="dl">
        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_tls</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Tells Impala to start a TLS connection to the LDAP server, and to fail
              authentication if it cannot be done.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--ldap_ca_certificate</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Specifies the location of the certificate in standard <code class="ph codeph">.PEM</code>
              format. Store this certificate on the local filesystem, in a location that only
              the <code class="ph codeph">impala</code> user and other trusted users can read.
            </p>

          </dd>


        
      </dl>


    </div>


  </div>


  <div class="topic concept nested1" aria-labelledby="ariaid-title9" id="ldap_impala_shell">

    <h2 class="title topictitle2" id="ariaid-title9">LDAP Authentication for impala-shell</h2>


    <div class="body conbody">

      <p class="p">
        To connect to Impala using LDAP authentication, you specify command-line options to the
        <span class="keyword cmdname">impala-shell</span> command interpreter and enter the password when
        prompted:
      </p>


      <dl class="dl">
        

          <dt class="dt dlterm">
            <code class="ph codeph">-l</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Enables LDAP authentication.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">-u</code>
          </dt>


          <dd class="dd">
            <p class="p">
              Sets the user. Per Active Directory, the user is the short username, not the full
              LDAP distinguished name. If your LDAP settings include a search base, use the
              <code class="ph codeph">--ldap_bind_pattern</code> on the <span class="keyword cmdname">impalad</span> daemon to
              translate the short username from <span class="keyword cmdname">impala-shell</span> automatically
              to the fully qualified name.
            </p>

          </dd>


        

        

          <dt class="dt dlterm">
            <code class="ph codeph">--auth_creds_ok_in_clear</code>
          </dt>


          <dd class="dd">
            <p class="p">
              If set, LDAP authentication may be used with an insecure
              connection to Impala. This flag is required when SSL between
              <code class="ph codeph">impala-shell</code> and Impala Server is not configured.
              Authentication credentials will therefore be sent unencrypted, and
              may be vulnerable to attack.
            </p>

          </dd>


        
      </dl>


      <div class="note note"><span class="notetitle">Note:</span> 
        <span class="keyword cmdname">impala-shell</span> automatically prompts for the password.
      </div>


      <p class="p">
        See <a class="xref" href="impala_jdbc.html#impala_jdbc">Configuring Impala to Work with JDBC</a> for the format to use with the JDBC
        connection string for servers using LDAP authentication.
      </p>


    </div>


  </div>


  <div class="topic concept nested1" aria-labelledby="ariaid-title10" id="ldap_impala_hue">

    <h2 class="title topictitle2" id="ariaid-title10">Enabling LDAP for Impala in Hue</h2>


    

    <div class="body conbody">

      <div class="section" id="ldap_impala_hue__ldap_impala_hue_cmdline"><h3 class="title sectiontitle">Enabling LDAP for Impala in Hue in the Command Line Interface</h3>

        

        <div class="p">
          LDAP authentication for the Impala app in Hue can be enabled by setting the following
          properties under the <code class="ph codeph">[impala]</code> section in <code class="ph codeph">hue.ini</code>.
          <dl class="dl">
            

              <dt class="dt dlterm">
                <code class="ph codeph">auth_username</code>
              </dt>


              <dd class="dd">
                <p class="p">
                  LDAP username of Hue user to be authenticated.
                </p>

              </dd>


            

            

              <dt class="dt dlterm">
                <code class="ph codeph">auth_password</code>
              </dt>


              <dd class="dd">
                <p class="p">
                  LDAP password of Hue user to be authenticated.
                </p>

              </dd>


            
          </dl>

          These login details are only used by Impala to authenticate to LDAP. The Impala
          service trusts Hue to have already validated the user being impersonated, rather than
          simply passing on the credentials.
        </div>


      </div>


    </div>


  </div>


  <div class="topic concept nested1" aria-labelledby="ariaid-title11" id="ldap_delegation">

    <h2 class="title topictitle2" id="ariaid-title11">Enabling Impala Delegation for LDAP Users</h2>


    <div class="body conbody">

      <p class="p">
        See <a class="xref" href="impala_delegation.html#delegation">Configuring Impala Delegation for Clients</a> for details about the delegation
        feature that lets certain users submit queries using the credentials of other users.
      </p>


    </div>


  </div>


  <div class="topic concept nested1" aria-labelledby="ariaid-title12" id="ldap_restrictions">

    <h2 class="title topictitle2" id="ariaid-title12">LDAP Restrictions for Impala</h2>


    <div class="body conbody">

      <p class="p">
        The LDAP support is preliminary. It currently has only been tested against Active
        Directory.
      </p>


    </div>


  </div>


</body>
</html>