<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2025" />
<meta name="DC.rights.owner" content="(C) Copyright 2025" />
<meta name="DC.Type" content="concept" />
<meta name="DC.Title" content="Configuring Catalog for High Availability" />
<meta name="DC.Relation" scheme="URI" content="../topics/impala_ha.html" />
<meta name="prodname" content="Impala" />
<meta name="version" content="Impala 3.4.x" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="impala_ha_catalog" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Configuring Catalog for High Availability</title>
</head>
<body id="impala_ha_catalog">

  <h1 class="title topictitle1" id="ariaid-title1">Configuring Catalog for High Availability</h1>

  
  <div class="body conbody">
    <p class="p">With any new query requests, the Impala coordinator sends metadata requests to Catalog
      service and sends metadata updates to Catalog which in turn propagates metadata updates to
      hive metastore. With a pair of primary/standby Catalog instances, the standby Catalog instance
      will be promoted as the primary instance to continue Catalog service for Impala cluster when
      the primary instance goes down. The active Catalogd acts as the source of metadata and
      provides Catalog service for the Impala cluster. This high availability mode of Catalog
      service reduces the outage duration of the Impala cluster when the primary Catalog instance
      fails. To support Catalog HA, you can now add two Catalogd instances in an Active-Passive high
      availability pair to an Impala cluster.</p>

  </div>

  <div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../topics/impala_ha.html">Configuring Impala for High Availability</a></div>
</div>
</div><div class="topic concept nested1" aria-labelledby="ariaid-title2" id="enabling_catalog_ha">
    <h2 class="title topictitle2" id="ariaid-title2">Enabling Catalog High Availability</h2>

    <div class="body conbody">
      <div class="p">To enable Catalog high availability in an Impala cluster, follow these steps:<ul class="ul" id="enabling_catalog_ha__ul_pj4_ycn_1cc">
          <li class="li">Set the starting flag <code class="ph codeph">enable_catalogd_ha</code> to <code class="ph codeph">true</code> for
            both catalogd instances and the StateStore.</li>

        </ul>
</div>

      <p class="p">The active StateStore will assign roles to the CatalogD instances, designating one as the
        active CatalogD and the other as the standby CatalogD. The active CatalogD acts as the
        source of metadata and provides Catalog services for the Impala cluster.</p>

    </div>

  </div>

  <div class="topic concept nested1" aria-labelledby="ariaid-title3" id="disabling_catalog_ha">
    <h2 class="title topictitle2" id="ariaid-title3">Disabling Catalog High Availability</h2>

    <div class="body conbody">
      <div class="p">To disable Catalog high availability in an Impala cluster, follow these steps:<ol class="ol" id="disabling_catalog_ha__ol_udj_b1n_1cc">
          <li class="li">Remove one CatalogD instance from the Impala cluster.</li>

          <li class="li">Restart the remaining CatalogD instance without the starting flag
              <code class="ph codeph">enable_catalogd_ha</code>.</li>

          <li class="li">Restart the StateStore without the starting flag
            <code class="ph codeph">enable_catalogd_ha</code>.</li>

        </ol>
</div>

    </div>

  </div>

  <div class="topic concept nested1" aria-labelledby="ariaid-title4" id="monitoring_status_ha">
    <h2 class="title topictitle2" id="ariaid-title4">Monitoring Catalog HA Status in the StateStore Web Page</h2>

    <div class="body conbody">
      <p class="p">A new web page <code class="ph codeph">/catalog_ha_info</code> has been added to the StateStore debug web
        server. This page displays the Catalog HA status, including:</p>

      <ul class="ul" id="monitoring_status_ha__ha_status_web">
        <li class="li">Active Catalog Node</li>

        <li class="li">Standby Catalog Node</li>

        <li class="li">Notified Subscribers Table</li>

      </ul>

      <p class="p">To access this information, navigate to the <code class="ph codeph">/catalog_ha_info</code> page on the
        StateStore debug web server.</p>

    </div>

  </div>

  <div class="topic concept nested1" aria-labelledby="ariaid-title5" id="catalog_failure_detection">
    <h2 class="title topictitle2" id="ariaid-title5">Catalog Failure Detection</h2>

    <div class="body conbody">
      <p class="p">The StateStore instance continuously sends heartbeat to its registered clients, including
        the primary and standby Catalog instances, to track Impala daemons in the cluster to
        determine if the daemon is healthy. If the StateStore finds the primary Catalog instance is
        not healthy but the standby Catalog instance is healthy, StateStore promotes the standby
        Catalog instance as primary instance and notify all coordinators for this change.
        Coordinators will switch over to the new primary Catalog instance.</p>

      <p class="p">When the system detects that the active CatalogD is unhealthy, it initiates a failover to
        the standby CatalogD. During this brief transition, some nodes might not immediately
        recognize the new active CatalogD, causing currently running queries to fail due to lack of
        access to metadata. These failed queries need to be rerun after the failover is complete and
        the new active CatalogD is operational.</p>

    </div>

  </div>

</body>
</html>