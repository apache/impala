====
---- QUERY : TPCH-Q9
# Q9 - Product Type Measure Query
# Modifications: Removed subquery, converted selects from multiple tables to joins,
# added limit, added round()
select
  n.n_name as nation,
  year(o.o_orderdate) as o_year,
  round(sum(l.l_extendedprice * (1 - l.l_discount) -
            ps.ps_supplycost * l.l_quantity), 1) as sum_profit
from tpch.lineitem$TABLE l
  join tpch.part$TABLE p
    on (p.p_partkey = l.l_partkey)
  join tpch.orders$TABLE o
    on (o.o_orderkey = l.l_orderkey)
  join tpch.partsupp$TABLE ps
    on (ps.ps_suppkey = l.l_suppkey and ps.ps_partkey = l.l_partkey)
  join tpch.supplier$TABLE s
    on (s.s_suppkey = l.l_suppkey)
  join tpch.nation$TABLE n
    on (s.s_nationkey = n.n_nationkey)
where
  p.p_name like '%green%'
group by
  n.n_name,
  year(o.o_orderdate)
order by
  nation,
  o_year desc
limit 200
---- RESULTS
'ALGERIA',1998,27136900.2
'ALGERIA',1997,48611833.5
'ALGERIA',1996,48285482.7
'ALGERIA',1995,44402273.6
'ALGERIA',1994,48694008.1
'ALGERIA',1993,46044207.8
'ALGERIA',1992,45636849.5
'ARGENTINA',1998,28341663.8
'ARGENTINA',1997,47143964.1
'ARGENTINA',1996,45255278.6
'ARGENTINA',1995,45631769.2
'ARGENTINA',1994,48268856.4
'ARGENTINA',1993,48605593.6
'ARGENTINA',1992,46654240.7
'BRAZIL',1998,26527736.4
'BRAZIL',1997,45640660.8
'BRAZIL',1996,45090647.2
'BRAZIL',1995,44015888.5
'BRAZIL',1994,44854218.9
'BRAZIL',1993,45766603.7
'BRAZIL',1992,45280216.8
'CANADA',1998,26828985.4
'CANADA',1997,44849954.3
'CANADA',1996,46307936.1
'CANADA',1995,47311993
'CANADA',1994,46691492
'CANADA',1993,46634791.1
'CANADA',1992,45873849.7
'CHINA',1998,27510180.2
'CHINA',1997,46123865.4
'CHINA',1996,49532807.1
'CHINA',1995,46734651.5
'CHINA',1994,46397896.6
'CHINA',1993,49634673.9
'CHINA',1992,46949457.6
'EGYPT',1998,28401491.8
'EGYPT',1997,47674857.7
'EGYPT',1996,47745727.5
'EGYPT',1995,45897160.7
'EGYPT',1994,47194895.2
'EGYPT',1993,49133627.6
'EGYPT',1992,47000574.5
'ETHIOPIA',1998,25135046.1
'ETHIOPIA',1997,43010596.1
'ETHIOPIA',1996,43636287.2
'ETHIOPIA',1995,43575757.3
'ETHIOPIA',1994,41597208.5
'ETHIOPIA',1993,42622804.2
'ETHIOPIA',1992,44385735.7
'FRANCE',1998,26210392.3
'FRANCE',1997,42392969.5
'FRANCE',1996,43306318
'FRANCE',1995,46377408.4
'FRANCE',1994,43447353
'FRANCE',1993,43729961.1
'FRANCE',1992,44052308.4
'GERMANY',1998,25991257.1
'GERMANY',1997,43968355.8
'GERMANY',1996,45882074.8
'GERMANY',1995,43314338.3
'GERMANY',1994,44616995.4
'GERMANY',1993,45126645.9
'GERMANY',1992,44361141.2
'INDIA',1998,29626417.2
'INDIA',1997,51386111.3
'INDIA',1996,47571018.5
'INDIA',1995,49344062.3
'INDIA',1994,50106952.4
'INDIA',1993,48112766.7
'INDIA',1992,47914303.1
'INDONESIA',1998,27734909.7
'INDONESIA',1997,44593813
'INDONESIA',1996,44746729.8
'INDONESIA',1995,45593622.7
'INDONESIA',1994,45988483.9
'INDONESIA',1993,46147963.8
'INDONESIA',1992,45185777.1
'IRAN',1998,26661608.9
'IRAN',1997,45019114.2
'IRAN',1996,45891397.1
'IRAN',1995,44414285.2
'IRAN',1994,43696360.5
'IRAN',1993,45362775.8
'IRAN',1992,43052338.4
'IRAQ',1998,31188498.2
'IRAQ',1997,48585307.5
'IRAQ',1996,50036593.8
'IRAQ',1995,48774801.7
'IRAQ',1994,48795847.2
'IRAQ',1993,47435691.5
'IRAQ',1992,47562355.7
'JAPAN',1998,24694102.2
'JAPAN',1997,42377052.3
'JAPAN',1996,40267778.9
'JAPAN',1995,40925317.5
'JAPAN',1994,41159518.3
'JAPAN',1993,39589074.3
'JAPAN',1992,39113493.9
'JORDAN',1998,23489867.8
'JORDAN',1997,41615962.7
'JORDAN',1996,41860855.5
'JORDAN',1995,39931672.1
'JORDAN',1994,40707555.5
'JORDAN',1993,39060405.5
'JORDAN',1992,41657604.3
'KENYA',1998,25566337.4
'KENYA',1997,43108847.9
'KENYA',1996,43482953.5
'KENYA',1995,42517989
'KENYA',1994,43612479.5
'KENYA',1993,42724038.8
'KENYA',1992,43217106.2
'MOROCCO',1998,24915496.9
'MOROCCO',1997,42698382.9
'MOROCCO',1996,42986113.5
'MOROCCO',1995,42316089.2
'MOROCCO',1994,43458604.6
'MOROCCO',1993,42672288.1
'MOROCCO',1992,42800781.6
'MOZAMBIQUE',1998,28279876
'MOZAMBIQUE',1997,51159216.2
'MOZAMBIQUE',1996,48072525.1
'MOZAMBIQUE',1995,48905200.6
'MOZAMBIQUE',1994,46092076.3
'MOZAMBIQUE',1993,48555926.3
'MOZAMBIQUE',1992,47809075.1
'PERU',1998,26713966.3
'PERU',1997,48324008.6
'PERU',1996,50310008.9
'PERU',1995,49647081
'PERU',1994,46420910.3
'PERU',1993,51536906.2
'PERU',1992,47711665.3
'ROMANIA',1998,27271993.1
'ROMANIA',1997,45063059.2
'ROMANIA',1996,47492335
'ROMANIA',1995,45710636.3
'ROMANIA',1994,46088041.1
'ROMANIA',1993,47515092.6
'ROMANIA',1992,44111439.8
'RUSSIA',1998,27935323.7
'RUSSIA',1997,48222347.3
'RUSSIA',1996,47553559.5
'RUSSIA',1995,46755990.1
'RUSSIA',1994,48000515.6
'RUSSIA',1993,48569624.5
'RUSSIA',1992,47672831.5
'SAUDI ARABIA',1998,27113516.8
'SAUDI ARABIA',1997,46690469
'SAUDI ARABIA',1996,47775782.7
'SAUDI ARABIA',1995,46657107.8
'SAUDI ARABIA',1994,48181672.8
'SAUDI ARABIA',1993,45692556.4
'SAUDI ARABIA',1992,48924913.3
'UNITED KINGDOM',1998,26366682.9
'UNITED KINGDOM',1997,44518130.2
'UNITED KINGDOM',1996,45539729.6
'UNITED KINGDOM',1995,46845879.3
'UNITED KINGDOM',1994,43081609.6
'UNITED KINGDOM',1993,44770146.8
'UNITED KINGDOM',1992,44123402.5
'UNITED STATES',1998,27826593.7
'UNITED STATES',1997,46638572.4
'UNITED STATES',1996,46688280.5
'UNITED STATES',1995,48951591.6
'UNITED STATES',1994,45099092.1
'UNITED STATES',1993,46181600.5
'UNITED STATES',1992,46168214.1
'VIETNAM',1998,27281931
'VIETNAM',1997,48735914.2
'VIETNAM',1996,47824595.9
'VIETNAM',1995,48235135.8
'VIETNAM',1994,47729256.3
'VIETNAM',1993,45352676.9
'VIETNAM',1992,47846355.6
---- TYPES
STRING, INT, DOUBLE
====