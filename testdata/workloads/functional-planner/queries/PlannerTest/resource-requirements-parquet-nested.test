# Parquet nested types, left nested in scan - should reserve memory for each scalar
# column in the nested collection plus the top-level column.
select c_custkey, o_orderkey, o_orderstatus, o_totalprice, o_orderdate, o_orderpriority,
    o_clerk
from tpch_nested_parquet.customer c, c.c_orders
---- PLAN
Max Per-Host Resource Reservation: Memory=36.00MB Threads=2
Per-Host Resource Estimates: Memory=188MB
Analyzed query: SELECT c_custkey, o_orderkey, o_orderstatus, o_totalprice,
o_orderdate, o_orderpriority, o_clerk FROM tpch_nested_parquet.customer c,
c.c_orders

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=188.00MB mem-reservation=36.00MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: c_custkey, o_orderkey, o_orderstatus, o_totalprice, o_orderdate, o_orderpriority, o_clerk
|  mem-estimate=100.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=1,0 row-size=84B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--04:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=20B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=1,0 row-size=84B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=20B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c]
   HDFS partitions=1/1 files=4 size=289.07MB
   predicates: !empty(c.c_orders)
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=32.00MB thread-reservation=1
   tuple-ids=0 row-size=20B cardinality=150.00K
   in pipelines: 00(GETNEXT)
====
# Parquet nested types, left nested in scan - should reserve memory for each scalar
# column (excluding pos) in the nested collection plus the top-level column.
select c_custkey, o_orderkey, pos
from tpch_nested_parquet.customer c, c.c_orders
---- PLAN
Max Per-Host Resource Reservation: Memory=12.00MB Threads=2
Per-Host Resource Estimates: Memory=139MB
Analyzed query: SELECT c_custkey, o_orderkey, pos FROM
tpch_nested_parquet.customer c, c.c_orders

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=139.50MB mem-reservation=12.00MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: c_custkey, o_orderkey, pos
|  mem-estimate=51.50MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=1,0 row-size=36B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--04:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=20B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=1,0 row-size=36B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=20B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c]
   HDFS partitions=1/1 files=4 size=289.07MB
   predicates: !empty(c.c_orders)
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=8.00MB thread-reservation=1
   tuple-ids=0 row-size=20B cardinality=150.00K
   in pipelines: 00(GETNEXT)
====
# Parquet nested types, left nested in scan - should reserve memory for virtual
# pos column in the nested collection because nothing else is materialized from
# the collection, plus the top-level column.
select c_custkey, pos
from tpch_nested_parquet.customer c, c.c_orders
---- PLAN
Max Per-Host Resource Reservation: Memory=12.00MB Threads=2
Per-Host Resource Estimates: Memory=128MB
Analyzed query: SELECT c_custkey, pos FROM tpch_nested_parquet.customer c,
c.c_orders

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=128.05MB mem-reservation=12.00MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: c_custkey, pos
|  mem-estimate=40.05MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=1,0 row-size=28B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--04:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=20B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=1,0 row-size=28B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=20B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c]
   HDFS partitions=1/1 files=4 size=289.07MB
   predicates: !empty(c.c_orders)
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=8.00MB thread-reservation=1
   tuple-ids=0 row-size=20B cardinality=150.00K
   in pipelines: 00(GETNEXT)
====
# Parquet nested types, left nested in scan - should reserve memory for nested column
# plus top-level column even though nested fields are not materialized because the
# column levels still need to be scanned to determine the # of elements in the collection.
select c_custkey
from tpch_nested_parquet.customer c, c.c_orders
---- PLAN
Max Per-Host Resource Reservation: Memory=12.00MB Threads=2
Per-Host Resource Estimates: Memory=117MB
Analyzed query: SELECT c_custkey FROM tpch_nested_parquet.customer c, c.c_orders

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=116.61MB mem-reservation=12.00MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: c_custkey
|  mem-estimate=28.61MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=1,0 row-size=20B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--04:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=20B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=1,0 row-size=20B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=20B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c]
   HDFS partitions=1/1 files=4 size=289.07MB
   predicates: !empty(c.c_orders)
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=8.00MB thread-reservation=1
   tuple-ids=0 row-size=20B cardinality=150.00K
   in pipelines: 00(GETNEXT)
====
# Parquet nested types, left nested in scan - should reserve memory for nested column
# only when no top-level column is materialized.
select o_orderkey
from tpch_nested_parquet.customer c, c.c_orders
---- PLAN
Max Per-Host Resource Reservation: Memory=8.00MB Threads=2
Per-Host Resource Estimates: Memory=117MB
Analyzed query: SELECT o_orderkey FROM tpch_nested_parquet.customer c,
c.c_orders

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=116.61MB mem-reservation=8.00MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: o_orderkey
|  mem-estimate=28.61MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=1,0 row-size=20B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--04:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=12B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=1,0 row-size=20B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=12B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c]
   HDFS partitions=1/1 files=4 size=289.07MB
   predicates: !empty(c.c_orders)
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns: unavailable
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=4.00MB thread-reservation=1
   tuple-ids=0 row-size=12B cardinality=150.00K
   in pipelines: 00(GETNEXT)
====
# Parquet nested types with two levels of nesting materialized in scan. Should
# reserve memory for columns at all three levels
select c_custkey, o_orderkey, l_comment
from tpch_nested_parquet.customer c, c.c_orders o, o.o_lineitems
---- PLAN
Max Per-Host Resource Reservation: Memory=20.00MB Threads=2
Per-Host Resource Estimates: Memory=188MB
Analyzed query: SELECT c_custkey, o_orderkey, l_comment FROM
tpch_nested_parquet.customer c, c.c_orders o, o.o_lineitems

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=188.00MB mem-reservation=20.00MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: c_custkey, o_orderkey, l_comment
|  mem-estimate=100.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=2,1,0 row-size=52B cardinality=15.00M
|  in pipelines: 00(GETNEXT)
|
|--08:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=20B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=2,1,0 row-size=52B cardinality=100
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=20B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  04:SUBPLAN
|  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=2,1 row-size=32B cardinality=100
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--07:NESTED LOOP JOIN [CROSS JOIN]
|  |  |  mem-estimate=20B mem-reservation=0B thread-reservation=0
|  |  |  tuple-ids=2,1 row-size=32B cardinality=10
|  |  |  in pipelines: 00(GETNEXT)
|  |  |
|  |  |--05:SINGULAR ROW SRC
|  |  |     parent-subplan=04
|  |  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |  |     tuple-ids=1 row-size=20B cardinality=1
|  |  |     in pipelines: 00(GETNEXT)
|  |  |
|  |  06:UNNEST [o.o_lineitems]
|  |     parent-subplan=04
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=2 row-size=0B cardinality=10
|  |     in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders o]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c]
   HDFS partitions=1/1 files=4 size=289.07MB
   predicates: !empty(c.c_orders)
   predicates on o: !empty(o.o_lineitems)
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=16.00MB thread-reservation=1
   tuple-ids=0 row-size=20B cardinality=150.00K
   in pipelines: 00(GETNEXT)
====
# Variety of operators in and outside of subplan. All operators in subplan consume
# resources while the subplan is open.
select distinct c_name, v.o_orderkey, v.o_orderstatus
from tpch_nested_parquet.customer c,
  (select distinct o1.o_orderkey, o2.o_orderstatus
   from c.c_orders o1
   join c.c_orders o2 on o1.o_orderkey = o2.o_orderkey
   order by o1.o_orderkey limit 100) v
---- PLAN
Max Per-Host Resource Reservation: Memory=85.94MB Threads=2
Per-Host Resource Estimates: Memory=346MB
Analyzed query: SELECT DISTINCT c_name, v.o_orderkey, v.o_orderstatus FROM
tpch_nested_parquet.customer c, (SELECT DISTINCT o1.o_orderkey, o2.o_orderstatus
FROM c.c_orders o1 INNER JOIN c.c_orders o2 ON o1.o_orderkey = o2.o_orderkey
ORDER BY o1.o_orderkey ASC LIMIT CAST(100 AS TINYINT)) v

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=345.94MB mem-reservation=85.94MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: c_name, v.o_orderkey, v.o_orderstatus
|  mem-estimate=71.53MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
09:AGGREGATE [FINALIZE]
|  group by: c_name, o1.o_orderkey, o2.o_orderstatus
|  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
|  tuple-ids=6 row-size=50B cardinality=1.50M
|  in pipelines: 09(GETNEXT), 00(OPEN)
|
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=4,0 row-size=74B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--08:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=54B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=4,0 row-size=74B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=54B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  07:TOP-N [LIMIT=100]
|  |  order by: o1.o_orderkey ASC
|  |  mem-estimate=200B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=4 row-size=20B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  06:AGGREGATE [FINALIZE]
|  |  group by: o1.o_orderkey, o2.o_orderstatus
|  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=3 row-size=20B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  05:HASH JOIN [INNER JOIN]
|  |  hash predicates: o1.o_orderkey = o2.o_orderkey
|  |  fk/pk conjuncts: assumed fk/pk
|  |  mem-estimate=1.94MB mem-reservation=1.94MB spill-buffer=64.00KB thread-reservation=0
|  |  tuple-ids=1,2 row-size=28B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--04:UNNEST [c.c_orders o2]
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=2 row-size=0B cardinality=10
|  |     in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders o1]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c]
   HDFS partitions=1/1 files=4 size=289.07MB
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders, c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=16.00MB thread-reservation=1
   tuple-ids=0 row-size=54B cardinality=150.00K
   in pipelines: 00(GETNEXT)
---- DISTRIBUTEDPLAN
Max Per-Host Resource Reservation: Memory=91.88MB Threads=4
Per-Host Resource Estimates: Memory=448MB
Analyzed query: SELECT DISTINCT c_name, v.o_orderkey, v.o_orderstatus FROM
tpch_nested_parquet.customer c, (SELECT DISTINCT o1.o_orderkey, o2.o_orderstatus
FROM c.c_orders o1 INNER JOIN c.c_orders o2 ON o1.o_orderkey = o2.o_orderkey
ORDER BY o1.o_orderkey ASC LIMIT CAST(100 AS TINYINT)) v

F02:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=81.68MB mem-reservation=4.00MB thread-reservation=1
PLAN-ROOT SINK
|  output exprs: c_name, v.o_orderkey, v.o_orderstatus
|  mem-estimate=71.53MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
12:EXCHANGE [UNPARTITIONED]
|  mem-estimate=10.16MB mem-reservation=0B thread-reservation=0
|  tuple-ids=6 row-size=50B cardinality=1.50M
|  in pipelines: 11(GETNEXT)
|
F01:PLAN FRAGMENT [HASH(c_name,v.o_orderkey,v.o_orderstatus)] hosts=3 instances=3
Per-Host Resources: mem-estimate=20.16MB mem-reservation=1.94MB thread-reservation=1
11:AGGREGATE [FINALIZE]
|  group by: c_name, v.o_orderkey, v.o_orderstatus
|  mem-estimate=10.00MB mem-reservation=1.94MB spill-buffer=64.00KB thread-reservation=0
|  tuple-ids=6 row-size=50B cardinality=1.50M
|  in pipelines: 11(GETNEXT), 00(OPEN)
|
10:EXCHANGE [HASH(c_name,v.o_orderkey,v.o_orderstatus)]
|  mem-estimate=10.16MB mem-reservation=0B thread-reservation=0
|  tuple-ids=6 row-size=50B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
F00:PLAN FRAGMENT [RANDOM] hosts=3 instances=3
Per-Host Resources: mem-estimate=346.57MB mem-reservation=85.94MB thread-reservation=2
09:AGGREGATE [STREAMING]
|  group by: c_name, o1.o_orderkey, o2.o_orderstatus
|  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
|  tuple-ids=6 row-size=50B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=4,0 row-size=74B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--08:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=54B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=4,0 row-size=74B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=54B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  07:TOP-N [LIMIT=100]
|  |  order by: o1.o_orderkey ASC
|  |  mem-estimate=200B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=4 row-size=20B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  06:AGGREGATE [FINALIZE]
|  |  group by: o1.o_orderkey, o2.o_orderstatus
|  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=3 row-size=20B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  05:HASH JOIN [INNER JOIN]
|  |  hash predicates: o1.o_orderkey = o2.o_orderkey
|  |  fk/pk conjuncts: assumed fk/pk
|  |  mem-estimate=1.94MB mem-reservation=1.94MB spill-buffer=64.00KB thread-reservation=0
|  |  tuple-ids=1,2 row-size=28B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--04:UNNEST [c.c_orders o2]
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=2 row-size=0B cardinality=10
|  |     in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders o1]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c, RANDOM]
   HDFS partitions=1/1 files=4 size=289.07MB
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders, c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=16.00MB thread-reservation=1
   tuple-ids=0 row-size=54B cardinality=150.00K
   in pipelines: 00(GETNEXT)
---- PARALLELPLANS
Max Per-Host Resource Reservation: Memory=179.75MB Threads=5
Per-Host Resource Estimates: Memory=816MB
Analyzed query: SELECT DISTINCT c_name, v.o_orderkey, v.o_orderstatus FROM
tpch_nested_parquet.customer c, (SELECT DISTINCT o1.o_orderkey, o2.o_orderstatus
FROM c.c_orders o1 INNER JOIN c.c_orders o2 ON o1.o_orderkey = o2.o_orderkey
ORDER BY o1.o_orderkey ASC LIMIT CAST(100 AS TINYINT)) v

F02:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Instance Resources: mem-estimate=81.74MB mem-reservation=4.00MB thread-reservation=1
PLAN-ROOT SINK
|  output exprs: c_name, v.o_orderkey, v.o_orderstatus
|  mem-estimate=71.53MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
12:EXCHANGE [UNPARTITIONED]
|  mem-estimate=10.21MB mem-reservation=0B thread-reservation=0
|  tuple-ids=6 row-size=50B cardinality=1.50M
|  in pipelines: 11(GETNEXT)
|
F01:PLAN FRAGMENT [HASH(c_name,v.o_orderkey,v.o_orderstatus)] hosts=3 instances=4
Per-Instance Resources: mem-estimate=20.21MB mem-reservation=1.94MB thread-reservation=1
11:AGGREGATE [FINALIZE]
|  group by: c_name, v.o_orderkey, v.o_orderstatus
|  mem-estimate=10.00MB mem-reservation=1.94MB spill-buffer=64.00KB thread-reservation=0
|  tuple-ids=6 row-size=50B cardinality=1.50M
|  in pipelines: 11(GETNEXT), 00(OPEN)
|
10:EXCHANGE [HASH(c_name,v.o_orderkey,v.o_orderstatus)]
|  mem-estimate=10.21MB mem-reservation=0B thread-reservation=0
|  tuple-ids=6 row-size=50B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
F00:PLAN FRAGMENT [RANDOM] hosts=3 instances=4
Per-Instance Resources: mem-estimate=346.78MB mem-reservation=85.94MB thread-reservation=1
09:AGGREGATE [STREAMING]
|  group by: c_name, o1.o_orderkey, o2.o_orderstatus
|  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
|  tuple-ids=6 row-size=50B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=4,0 row-size=74B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--08:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=54B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=4,0 row-size=74B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=54B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  07:TOP-N [LIMIT=100]
|  |  order by: o1.o_orderkey ASC
|  |  mem-estimate=200B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=4 row-size=20B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  06:AGGREGATE [FINALIZE]
|  |  group by: o1.o_orderkey, o2.o_orderstatus
|  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=3 row-size=20B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  05:HASH JOIN [INNER JOIN]
|  |  hash predicates: o1.o_orderkey = o2.o_orderkey
|  |  fk/pk conjuncts: assumed fk/pk
|  |  mem-estimate=1.94MB mem-reservation=1.94MB spill-buffer=64.00KB thread-reservation=0
|  |  tuple-ids=1,2 row-size=28B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--04:UNNEST [c.c_orders o2]
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=2 row-size=0B cardinality=10
|  |     in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders o1]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c, RANDOM]
   HDFS partitions=1/1 files=4 size=289.07MB
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders, c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=16.00MB thread-reservation=0
   tuple-ids=0 row-size=54B cardinality=150.00K
   in pipelines: 00(GETNEXT)
====
# Pipeline of blocking operators in a subplan. All operators consume resources at the
# same time (unlike blocking operators outside of a subplan).
select *
from tpch_nested_parquet.customer c,
  (select *, row_number() over (order by o_totalprice) rnum_price,
    row_number() over (order by o_orderdate) rnum_date,
    row_number() over (order by o_orderpriority) rnum_priority
   from c.c_orders) v;
---- PLAN
Max Per-Host Resource Reservation: Memory=108.00MB Threads=2
Per-Host Resource Estimates: Memory=236MB
Analyzed query: SELECT * FROM tpch_nested_parquet.customer c, (SELECT *,
row_number() OVER (ORDER BY o_totalprice ASC) rnum_price, row_number() OVER
(ORDER BY o_orderdate ASC) rnum_date, row_number() OVER (ORDER BY
o_orderpriority ASC) rnum_priority FROM c.c_orders) v

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=236.00MB mem-reservation=108.00MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: c.c_custkey, c.c_name, c.c_address, c.c_nationkey, c.c_phone, c.c_acctbal, c.c_mktsegment, c.c_comment, item.o_orderkey, item.o_orderstatus, item.o_totalprice, item.o_orderdate, item.o_orderpriority, item.o_clerk, item.o_shippriority, item.o_comment, row_number(), row_number(), row_number()
|  mem-estimate=100.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=12,7,0 row-size=366B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--10:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=230B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=12,7,0 row-size=366B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=230B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  09:ANALYTIC
|  |  functions: row_number()
|  |  order by: o_orderpriority ASC
|  |  window: ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
|  |  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=12,7 row-size=136B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  08:SORT
|  |  order by: o_orderpriority ASC
|  |  mem-estimate=12.00MB mem-reservation=12.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=12 row-size=128B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  07:ANALYTIC
|  |  functions: row_number()
|  |  order by: o_orderdate ASC
|  |  window: ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
|  |  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=10,6 row-size=128B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  06:SORT
|  |  order by: o_orderdate ASC
|  |  mem-estimate=12.00MB mem-reservation=12.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=10 row-size=120B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  05:ANALYTIC
|  |  functions: row_number()
|  |  order by: o_totalprice ASC
|  |  window: ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
|  |  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=8,5 row-size=120B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  04:SORT
|  |  order by: o_totalprice ASC
|  |  mem-estimate=12.00MB mem-reservation=12.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=8 row-size=112B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c]
   HDFS partitions=1/1 files=4 size=289.07MB
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=56.00MB thread-reservation=1
   tuple-ids=0 row-size=230B cardinality=150.00K
   in pipelines: 00(GETNEXT)
---- DISTRIBUTEDPLAN
Max Per-Host Resource Reservation: Memory=108.00MB Threads=3
Per-Host Resource Estimates: Memory=249MB
Analyzed query: SELECT * FROM tpch_nested_parquet.customer c, (SELECT *,
row_number() OVER (ORDER BY o_totalprice ASC) rnum_price, row_number() OVER
(ORDER BY o_orderdate ASC) rnum_date, row_number() OVER (ORDER BY
o_orderpriority ASC) rnum_priority FROM c.c_orders) v

F01:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=111.11MB mem-reservation=4.00MB thread-reservation=1
PLAN-ROOT SINK
|  output exprs: c.c_custkey, c.c_name, c.c_address, c.c_nationkey, c.c_phone, c.c_acctbal, c.c_mktsegment, c.c_comment, item.o_orderkey, item.o_orderstatus, item.o_totalprice, item.o_orderdate, item.o_orderpriority, item.o_clerk, item.o_shippriority, item.o_comment, row_number(), row_number(), row_number()
|  mem-estimate=100.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
11:EXCHANGE [UNPARTITIONED]
|  mem-estimate=11.11MB mem-reservation=0B thread-reservation=0
|  tuple-ids=12,7,0 row-size=366B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
F00:PLAN FRAGMENT [RANDOM] hosts=3 instances=3
Per-Host Resources: mem-estimate=137.48MB mem-reservation=104.00MB thread-reservation=2
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=12,7,0 row-size=366B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--10:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=230B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=12,7,0 row-size=366B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=230B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  09:ANALYTIC
|  |  functions: row_number()
|  |  order by: o_orderpriority ASC
|  |  window: ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
|  |  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=12,7 row-size=136B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  08:SORT
|  |  order by: o_orderpriority ASC
|  |  mem-estimate=12.00MB mem-reservation=12.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=12 row-size=128B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  07:ANALYTIC
|  |  functions: row_number()
|  |  order by: o_orderdate ASC
|  |  window: ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
|  |  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=10,6 row-size=128B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  06:SORT
|  |  order by: o_orderdate ASC
|  |  mem-estimate=12.00MB mem-reservation=12.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=10 row-size=120B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  05:ANALYTIC
|  |  functions: row_number()
|  |  order by: o_totalprice ASC
|  |  window: ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
|  |  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=8,5 row-size=120B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  04:SORT
|  |  order by: o_totalprice ASC
|  |  mem-estimate=12.00MB mem-reservation=12.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=8 row-size=112B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c, RANDOM]
   HDFS partitions=1/1 files=4 size=289.07MB
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=56.00MB thread-reservation=1
   tuple-ids=0 row-size=230B cardinality=150.00K
   in pipelines: 00(GETNEXT)
---- PARALLELPLANS
Max Per-Host Resource Reservation: Memory=212.00MB Threads=3
Per-Host Resource Estimates: Memory=386MB
Analyzed query: SELECT * FROM tpch_nested_parquet.customer c, (SELECT *,
row_number() OVER (ORDER BY o_totalprice ASC) rnum_price, row_number() OVER
(ORDER BY o_orderdate ASC) rnum_date, row_number() OVER (ORDER BY
o_orderpriority ASC) rnum_priority FROM c.c_orders) v

F01:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Instance Resources: mem-estimate=111.47MB mem-reservation=4.00MB thread-reservation=1
PLAN-ROOT SINK
|  output exprs: c.c_custkey, c.c_name, c.c_address, c.c_nationkey, c.c_phone, c.c_acctbal, c.c_mktsegment, c.c_comment, item.o_orderkey, item.o_orderstatus, item.o_totalprice, item.o_orderdate, item.o_orderpriority, item.o_clerk, item.o_shippriority, item.o_comment, row_number(), row_number(), row_number()
|  mem-estimate=100.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
11:EXCHANGE [UNPARTITIONED]
|  mem-estimate=11.47MB mem-reservation=0B thread-reservation=0
|  tuple-ids=12,7,0 row-size=366B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
F00:PLAN FRAGMENT [RANDOM] hosts=3 instances=4
Per-Instance Resources: mem-estimate=137.48MB mem-reservation=104.00MB thread-reservation=1
01:SUBPLAN
|  mem-estimate=0B mem-reservation=0B thread-reservation=0
|  tuple-ids=12,7,0 row-size=366B cardinality=1.50M
|  in pipelines: 00(GETNEXT)
|
|--10:NESTED LOOP JOIN [CROSS JOIN]
|  |  mem-estimate=230B mem-reservation=0B thread-reservation=0
|  |  tuple-ids=12,7,0 row-size=366B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  |--02:SINGULAR ROW SRC
|  |     parent-subplan=01
|  |     mem-estimate=0B mem-reservation=0B thread-reservation=0
|  |     tuple-ids=0 row-size=230B cardinality=1
|  |     in pipelines: 00(GETNEXT)
|  |
|  09:ANALYTIC
|  |  functions: row_number()
|  |  order by: o_orderpriority ASC
|  |  window: ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
|  |  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=12,7 row-size=136B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  08:SORT
|  |  order by: o_orderpriority ASC
|  |  mem-estimate=12.00MB mem-reservation=12.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=12 row-size=128B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  07:ANALYTIC
|  |  functions: row_number()
|  |  order by: o_orderdate ASC
|  |  window: ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
|  |  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=10,6 row-size=128B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  06:SORT
|  |  order by: o_orderdate ASC
|  |  mem-estimate=12.00MB mem-reservation=12.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=10 row-size=120B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  05:ANALYTIC
|  |  functions: row_number()
|  |  order by: o_totalprice ASC
|  |  window: ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
|  |  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=8,5 row-size=120B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  04:SORT
|  |  order by: o_totalprice ASC
|  |  mem-estimate=12.00MB mem-reservation=12.00MB spill-buffer=2.00MB thread-reservation=0
|  |  tuple-ids=8 row-size=112B cardinality=10
|  |  in pipelines: 00(GETNEXT)
|  |
|  03:UNNEST [c.c_orders]
|     parent-subplan=01
|     mem-estimate=0B mem-reservation=0B thread-reservation=0
|     tuple-ids=1 row-size=0B cardinality=10
|     in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpch_nested_parquet.customer c, RANDOM]
   HDFS partitions=1/1 files=4 size=289.07MB
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns missing stats: c_orders
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=56.00MB thread-reservation=0
   tuple-ids=0 row-size=230B cardinality=150.00K
   in pipelines: 00(GETNEXT)
====
# Parquet nested types, unnested in scan - should reserve memory for each column.
select o_orderkey, o_orderstatus, o_totalprice, o_orderdate, o_orderpriority, o_clerk
from tpch_nested_parquet.customer.c_orders
---- PLAN
Max Per-Host Resource Reservation: Memory=28.00MB Threads=2
Per-Host Resource Estimates: Memory=180MB
Analyzed query: SELECT o_orderkey, o_orderstatus, o_totalprice, o_orderdate,
o_orderpriority, o_clerk FROM tpch_nested_parquet.customer.c_orders

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=179.55MB mem-reservation=28.00MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: o_orderkey, o_orderstatus, o_totalprice, o_orderdate, o_orderpriority, o_clerk
|  mem-estimate=91.55MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
00:SCAN HDFS [tpch_nested_parquet.customer.c_orders]
   HDFS partitions=1/1 files=4 size=289.07MB
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns: all
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=24.00MB thread-reservation=1
   tuple-ids=0 row-size=64B cardinality=1.50M
   in pipelines: 00(GETNEXT)
====
# Parquet nested types, unnested in scan - don't reserve extra memory for "pos" virtual
# column that piggy-backs on another column.
select o_orderkey, pos
from tpch_nested_parquet.customer.c_orders
---- PLAN
Max Per-Host Resource Reservation: Memory=8.00MB Threads=2
Per-Host Resource Estimates: Memory=111MB
Analyzed query: SELECT o_orderkey, pos FROM
tpch_nested_parquet.customer.c_orders

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=110.89MB mem-reservation=8.00MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: o_orderkey, pos
|  mem-estimate=22.89MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
00:SCAN HDFS [tpch_nested_parquet.customer.c_orders]
   HDFS partitions=1/1 files=4 size=289.07MB
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns: all
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=4.00MB thread-reservation=1
   tuple-ids=0 row-size=16B cardinality=1.50M
   in pipelines: 00(GETNEXT)
====
# Parquet nested types, unnested in scan - reserve memory for "pos" virtual column if it
# is the only column materialized.
select pos
from tpch_nested_parquet.customer.c_orders
---- PLAN
Max Per-Host Resource Reservation: Memory=8.00MB Threads=2
Per-Host Resource Estimates: Memory=99MB
Analyzed query: SELECT pos FROM tpch_nested_parquet.customer.c_orders

F00:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Host Resources: mem-estimate=99.44MB mem-reservation=8.00MB thread-reservation=2
PLAN-ROOT SINK
|  output exprs: pos
|  mem-estimate=11.44MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0
|
00:SCAN HDFS [tpch_nested_parquet.customer.c_orders]
   HDFS partitions=1/1 files=4 size=289.07MB
   stored statistics:
     table: rows=150.00K size=289.07MB
     columns: all
   extrapolated-rows=disabled max-scan-range-rows=50.12K
   mem-estimate=88.00MB mem-reservation=4.00MB thread-reservation=1
   tuple-ids=0 row-size=8B cardinality=1.50M
   in pipelines: 00(GETNEXT)
====