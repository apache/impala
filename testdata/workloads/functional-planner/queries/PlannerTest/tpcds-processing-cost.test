# Regression test for IMPALA-12510: select star on empty table
select * from functional.emptytable;
---- PARALLELPLANS
Max Per-Host Resource Reservation: Memory=4.00MB Threads=2
Per-Host Resource Estimates: Memory=10MB
F01:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Instance Resources: mem-estimate=4.02MB mem-reservation=4.00MB thread-reservation=1
|  max-parallelism=1 segment-costs=[0]
PLAN-ROOT SINK
|  output exprs: functional.emptytable.field, functional.emptytable.f2
|  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0 cost=0
|
01:EXCHANGE [UNPARTITIONED]
|  mem-estimate=20.00KB mem-reservation=0B thread-reservation=0
|  tuple-ids=0 row-size=16B cardinality=0 cost=0
|  in pipelines: 00(GETNEXT)
|
F00:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Instance Resources: mem-estimate=80.00KB mem-reservation=0B thread-reservation=1
max-parallelism=1 segment-costs=[0]
00:SCAN HDFS [functional.emptytable, RANDOM]
   partitions=0/0 files=0 size=0B
   stored statistics:
     table: rows=unavailable size=unavailable
     partitions: 0/0 rows=0
     columns missing stats: field
   extrapolated-rows=disabled max-scan-range-rows=0
   mem-estimate=0B mem-reservation=0B thread-reservation=0
   tuple-ids=0 row-size=16B cardinality=0 cost=0
   in pipelines: 00(GETNEXT)
====
# IMPALA-12192: Test that scan fragment parallelism can scale beyond the scan node cost.
# In this query, preagg node colocated in the scan fragment will have higher cost than
# the scan node, and increase the parallelism of the scan fragment.
select
  ss_net_paid_inc_tax,
  ss_ext_list_price,
  ss_net_profit,
  ss_net_paid,
  ss_ext_sales_price,
  sum(ss_store_sk)
from store_sales
group by rollup (
  ss_net_paid_inc_tax,
  ss_ext_list_price,
  ss_net_profit,
  ss_net_paid,
  ss_ext_sales_price)
limit 100
---- PARALLELPLANS
Max Per-Host Resource Reservation: Memory=1.76GB Threads=11
Per-Host Resource Estimates: Memory=2.28GB
F02:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
|  Per-Instance Resources: mem-estimate=4.03MB mem-reservation=4.00MB thread-reservation=1
|  max-parallelism=1 segment-costs=[604] cpu-comparison-result=21 [max(1 (self) vs 21 (sum children))]
PLAN-ROOT SINK
|  output exprs: CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN ss_net_paid_inc_tax WHEN 2 THEN ss_net_paid_inc_tax WHEN 3 THEN ss_net_paid_inc_tax WHEN 4 THEN ss_net_paid_inc_tax WHEN 5 THEN ss_net_paid_inc_tax WHEN 6 THEN NULL END, CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN ss_ext_list_price WHEN 2 THEN ss_ext_list_price WHEN 3 THEN ss_ext_list_price WHEN 4 THEN ss_ext_list_price WHEN 5 THEN NULL WHEN 6 THEN NULL END, CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN ss_net_profit WHEN 2 THEN ss_net_profit WHEN 3 THEN ss_net_profit WHEN 4 THEN NULL WHEN 5 THEN NULL WHEN 6 THEN NULL END, CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN ss_net_paid WHEN 2 THEN ss_net_paid WHEN 3 THEN NULL WHEN 4 THEN NULL WHEN 5 THEN NULL WHEN 6 THEN NULL END, CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN ss_ext_sales_price WHEN 2 THEN NULL WHEN 3 THEN NULL WHEN 4 THEN NULL WHEN 5 THEN NULL WHEN 6 THEN NULL END, aggif(valid_tid(1,2,3,4,5,6) IN (1, 2, 3, 4, 5, 6), CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN sum(ss_store_sk) WHEN 2 THEN sum(ss_store_sk) WHEN 3 THEN sum(ss_store_sk) WHEN 4 THEN sum(ss_store_sk) WHEN 5 THEN sum(ss_store_sk) WHEN 6 THEN sum(ss_store_sk) END)
|  mem-estimate=4.00MB mem-reservation=4.00MB spill-buffer=2.00MB thread-reservation=0 cost=600
|
05:EXCHANGE [UNPARTITIONED]
|  limit: 100
|  mem-estimate=32.68KB mem-reservation=0B thread-reservation=0
|  tuple-ids=7 row-size=32B cardinality=100 cost=4
|  in pipelines: 02(GETNEXT)
|
F01:PLAN FRAGMENT [HASH(CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN murmur_hash(ss_net_paid_inc_tax) WHEN 2 THEN murmur_hash(ss_net_paid_inc_tax) WHEN 3 THEN murmur_hash(ss_net_paid_inc_tax) WHEN 4 THEN murmur_hash(ss_net_paid_inc_tax) WHEN 5 THEN murmur_hash(ss_net_paid_inc_tax) WHEN 6 THEN murmur_hash(NULL) END,CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN murmur_hash(ss_ext_list_price) WHEN 2 THEN murmur_hash(ss_ext_list_price) WHEN 3 THEN murmur_hash(ss_ext_list_price) WHEN 4 THEN murmur_hash(ss_ext_list_price) WHEN 5 THEN murmur_hash(NULL) WHEN 6 THEN murmur_hash(NULL) END,CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN murmur_hash(ss_net_profit) WHEN 2 THEN murmur_hash(ss_net_profit) WHEN 3 THEN murmur_hash(ss_net_profit) WHEN 4 THEN murmur_hash(NULL) WHEN 5 THEN murmur_hash(NULL) WHEN 6 THEN murmur_hash(NULL) END,CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN murmur_hash(ss_net_paid) WHEN 2 THEN murmur_hash(ss_net_paid) WHEN 3 THEN murmur_hash(NULL) WHEN 4 THEN murmur_hash(NULL) WHEN 5 THEN murmur_hash(NULL) WHEN 6 THEN murmur_hash(NULL) END,CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN murmur_hash(ss_ext_sales_price) WHEN 2 THEN murmur_hash(NULL) WHEN 3 THEN murmur_hash(NULL) WHEN 4 THEN murmur_hash(NULL) WHEN 5 THEN murmur_hash(NULL) WHEN 6 THEN murmur_hash(NULL) END)] hosts=3 instances=9 (adjusted from 48)
Per-Instance Resources: mem-estimate=303.35MB mem-reservation=188.94MB thread-reservation=1
max-parallelism=9 segment-costs=[75109407, 84972256, 4] cpu-comparison-result=21 [max(9 (self) vs 21 (sum children))]
02:AGGREGATE [FINALIZE]
|  output: aggif(valid_tid(1,2,3,4,5,6) IN (CAST(1 AS INT), CAST(2 AS INT), CAST(3 AS INT), CAST(4 AS INT), CAST(5 AS INT), CAST(6 AS INT)), CASE valid_tid(1,2,3,4,5,6) WHEN CAST(1 AS INT) THEN sum(ss_store_sk) WHEN CAST(2 AS INT) THEN sum(ss_store_sk) WHEN CAST(3 AS INT) THEN sum(ss_store_sk) WHEN CAST(4 AS INT) THEN sum(ss_store_sk) WHEN CAST(5 AS INT) THEN sum(ss_store_sk) WHEN CAST(6 AS INT) THEN sum(ss_store_sk) END)
|  group by: CASE valid_tid(1,2,3,4,5,6) WHEN CAST(1 AS INT) THEN ss_net_paid_inc_tax WHEN CAST(2 AS INT) THEN ss_net_paid_inc_tax WHEN CAST(3 AS INT) THEN ss_net_paid_inc_tax WHEN CAST(4 AS INT) THEN ss_net_paid_inc_tax WHEN CAST(5 AS INT) THEN ss_net_paid_inc_tax WHEN CAST(6 AS INT) THEN NULL END, CASE valid_tid(1,2,3,4,5,6) WHEN CAST(1 AS INT) THEN ss_ext_list_price WHEN CAST(2 AS INT) THEN ss_ext_list_price WHEN CAST(3 AS INT) THEN ss_ext_list_price WHEN CAST(4 AS INT) THEN ss_ext_list_price WHEN CAST(5 AS INT) THEN NULL WHEN CAST(6 AS INT) THEN NULL END, CASE valid_tid(1,2,3,4,5,6) WHEN CAST(1 AS INT) THEN ss_net_profit WHEN CAST(2 AS INT) THEN ss_net_profit WHEN CAST(3 AS INT) THEN ss_net_profit WHEN CAST(4 AS INT) THEN NULL WHEN CAST(5 AS INT) THEN NULL WHEN CAST(6 AS INT) THEN NULL END, CASE valid_tid(1,2,3,4,5,6) WHEN CAST(1 AS INT) THEN ss_net_paid WHEN CAST(2 AS INT) THEN ss_net_paid WHEN CAST(3 AS INT) THEN NULL WHEN CAST(4 AS INT) THEN NULL WHEN CAST(5 AS INT) THEN NULL WHEN CAST(6 AS INT) THEN NULL END, CASE valid_tid(1,2,3,4,5,6) WHEN CAST(1 AS INT) THEN ss_ext_sales_price WHEN CAST(2 AS INT) THEN NULL WHEN CAST(3 AS INT) THEN NULL WHEN CAST(4 AS INT) THEN NULL WHEN CAST(5 AS INT) THEN NULL WHEN CAST(6 AS INT) THEN NULL END, CASE valid_tid(1,2,3,4,5,6) WHEN CAST(1 AS INT) THEN CAST(1 AS INT) WHEN CAST(2 AS INT) THEN CAST(2 AS INT) WHEN CAST(3 AS INT) THEN CAST(3 AS INT) WHEN CAST(4 AS INT) THEN CAST(4 AS INT) WHEN CAST(5 AS INT) THEN CAST(5 AS INT) WHEN CAST(6 AS INT) THEN CAST(6 AS INT) END
|  limit: 100
|  mem-estimate=56.60MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
|  tuple-ids=7 row-size=32B cardinality=100 cost=84972256
|  in pipelines: 02(GETNEXT), 04(OPEN)
|
04:AGGREGATE [FINALIZE]
|  Class 0
|    output: sum:merge(ss_store_sk)
|    group by: ss_net_paid_inc_tax, ss_ext_list_price, ss_net_profit, ss_net_paid, ss_ext_sales_price
|  Class 1
|    output: sum:merge(ss_store_sk)
|    group by: ss_net_paid_inc_tax, ss_ext_list_price, ss_net_profit, ss_net_paid, NULL
|  Class 2
|    output: sum:merge(ss_store_sk)
|    group by: ss_net_paid_inc_tax, ss_ext_list_price, ss_net_profit, NULL, NULL
|  Class 3
|    output: sum:merge(ss_store_sk)
|    group by: ss_net_paid_inc_tax, ss_ext_list_price, NULL, NULL, NULL
|  Class 4
|    output: sum:merge(ss_store_sk)
|    group by: ss_net_paid_inc_tax, NULL, NULL, NULL, NULL
|  Class 5
|    output: sum:merge(ss_store_sk)
|    group by: NULL, NULL, NULL, NULL, NULL
|  mem-estimate=246.76MB mem-reservation=154.94MB thread-reservation=0
|  tuple-ids=1N,2N,3N,4N,5N,6N row-size=168B cardinality=12.14M cost=72833364
|  in pipelines: 04(GETNEXT), 00(OPEN)
|
03:EXCHANGE [HASH(CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN murmur_hash(ss_net_paid_inc_tax) WHEN 2 THEN murmur_hash(ss_net_paid_inc_tax) WHEN 3 THEN murmur_hash(ss_net_paid_inc_tax) WHEN 4 THEN murmur_hash(ss_net_paid_inc_tax) WHEN 5 THEN murmur_hash(ss_net_paid_inc_tax) WHEN 6 THEN murmur_hash(NULL) END,CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN murmur_hash(ss_ext_list_price) WHEN 2 THEN murmur_hash(ss_ext_list_price) WHEN 3 THEN murmur_hash(ss_ext_list_price) WHEN 4 THEN murmur_hash(ss_ext_list_price) WHEN 5 THEN murmur_hash(NULL) WHEN 6 THEN murmur_hash(NULL) END,CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN murmur_hash(ss_net_profit) WHEN 2 THEN murmur_hash(ss_net_profit) WHEN 3 THEN murmur_hash(ss_net_profit) WHEN 4 THEN murmur_hash(NULL) WHEN 5 THEN murmur_hash(NULL) WHEN 6 THEN murmur_hash(NULL) END,CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN murmur_hash(ss_net_paid) WHEN 2 THEN murmur_hash(ss_net_paid) WHEN 3 THEN murmur_hash(NULL) WHEN 4 THEN murmur_hash(NULL) WHEN 5 THEN murmur_hash(NULL) WHEN 6 THEN murmur_hash(NULL) END,CASE valid_tid(1,2,3,4,5,6) WHEN 1 THEN murmur_hash(ss_ext_sales_price) WHEN 2 THEN murmur_hash(NULL) WHEN 3 THEN murmur_hash(NULL) WHEN 4 THEN murmur_hash(NULL) WHEN 5 THEN murmur_hash(NULL) WHEN 6 THEN murmur_hash(NULL) END)]
|  mem-estimate=13.94MB mem-reservation=0B thread-reservation=0
|  tuple-ids=1N,2N,3N,4N,5N,6N row-size=168B cardinality=12.14M cost=2276043
|  in pipelines: 00(GETNEXT)
|
F00:PLAN FRAGMENT [RANDOM] hosts=3 instances=21 (adjusted from 48)
Per-Instance Resources: mem-estimate=202.75MB mem-reservation=176.00MB thread-reservation=1
max-parallelism=21 segment-costs=[194962048, 2276043]
01:AGGREGATE [STREAMING]
|  Class 0
|    output: sum(CAST(ss_store_sk AS BIGINT))
|    group by: ss_net_paid_inc_tax, ss_ext_list_price, ss_net_profit, ss_net_paid, ss_ext_sales_price
|  Class 1
|    output: sum(CAST(ss_store_sk AS BIGINT))
|    group by: ss_net_paid_inc_tax, ss_ext_list_price, ss_net_profit, ss_net_paid, NULL
|  Class 2
|    output: sum(CAST(ss_store_sk AS BIGINT))
|    group by: ss_net_paid_inc_tax, ss_ext_list_price, ss_net_profit, NULL, NULL
|  Class 3
|    output: sum(CAST(ss_store_sk AS BIGINT))
|    group by: ss_net_paid_inc_tax, ss_ext_list_price, NULL, NULL, NULL
|  Class 4
|    output: sum(CAST(ss_store_sk AS BIGINT))
|    group by: ss_net_paid_inc_tax, NULL, NULL, NULL, NULL
|  Class 5
|    output: sum(CAST(ss_store_sk AS BIGINT))
|    group by: NULL, NULL, NULL, NULL, NULL
|  mem-estimate=180.00MB mem-reservation=172.00MB thread-reservation=0
|  tuple-ids=1N,2N,3N,4N,5N,6N row-size=168B cardinality=12.14M cost=103694544
|  in pipelines: 00(GETNEXT)
|
00:SCAN HDFS [tpcds_partitioned_parquet_snap.store_sales, RANDOM]
   HDFS partitions=1824/1824 files=1824 size=199.36MB
   stored statistics:
     table: rows=2.88M size=199.36MB
     partitions: 1824/1824 rows=2.88M
     columns: all
   extrapolated-rows=disabled max-scan-range-rows=130.09K
   mem-estimate=16.00MB mem-reservation=4.00MB thread-reservation=0
   tuple-ids=0 row-size=24B cardinality=2.88M cost=91267504
   in pipelines: 00(GETNEXT)
====
