====
---- QUERY: TPCDS-Q80
with ssr as
 (select  s_store_id as store_id,
          sum(ss_ext_sales_price) as sales,
          sum(coalesce(sr_return_amt, 0)) as `returns`,
          sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit
  from store_sales left outer join store_returns on
         (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number),
     date_dim,
     store,
     item,
     promotion
 where ss_sold_date_sk = d_date_sk
       and d_date between cast('1998-08-04' as date)
                  and (cast('1998-08-04' as date) +  interval 30 days)
       and ss_store_sk = s_store_sk
       and ss_item_sk = i_item_sk
       and i_current_price > 50
       and ss_promo_sk = p_promo_sk
       and p_channel_tv = 'N'
 group by s_store_id)
 ,
 csr as
 (select  cp_catalog_page_id as catalog_page_id,
          sum(cs_ext_sales_price) as sales,
          sum(coalesce(cr_return_amount, 0)) as `returns`,
          sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit
  from catalog_sales left outer join catalog_returns on
         (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number),
     date_dim,
     catalog_page,
     item,
     promotion
 where cs_sold_date_sk = d_date_sk
       and d_date between cast('1998-08-04' as date)
                  and (cast('1998-08-04' as date) +  interval 30 days)
        and cs_catalog_page_sk = cp_catalog_page_sk
       and cs_item_sk = i_item_sk
       and i_current_price > 50
       and cs_promo_sk = p_promo_sk
       and p_channel_tv = 'N'
group by cp_catalog_page_id)
 ,
 wsr as
 (select  web_site_id,
          sum(ws_ext_sales_price) as sales,
          sum(coalesce(wr_return_amt, 0)) as `returns`,
          sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit
  from web_sales left outer join web_returns on
         (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number),
     date_dim,
     web_site,
     item,
     promotion
 where ws_sold_date_sk = d_date_sk
       and d_date between cast('1998-08-04' as date)
                  and (cast('1998-08-04' as date) +  interval 30 days)
        and ws_web_site_sk = web_site_sk
       and ws_item_sk = i_item_sk
       and i_current_price > 50
       and ws_promo_sk = p_promo_sk
       and p_channel_tv = 'N'
group by web_site_id)
  select  channel
        , id
        , sum(sales) as sales
        , sum(`returns`) as `returns`
        , sum(profit) as profit
 from
 (select 'store channel' as channel
        , 'store' || store_id as id
        , sales
        , `returns`
        , profit
 from   ssr
 union all
 select 'catalog channel' as channel
        , 'catalog_page' || catalog_page_id as id
        , sales
        , `returns`
        , profit
 from  csr
 union all
 select 'web channel' as channel
        , 'web_site' || web_site_id as id
        , sales
        , `returns`
        , profit
 from   wsr
 ) x
 group by rollup (channel, id)
 order by channel
         ,id
 limit 100;
---- RESULTS
'catalog channel','catalog_pageAAAAAAAAAABAAAAA',11343.60,0.00,-8455.61
'catalog channel','catalog_pageAAAAAAAAAADAAAAA',10707.91,2876.92,-18008.32
'catalog channel','catalog_pageAAAAAAAAABBAAAAA',388.99,0.00,-385.50
'catalog channel','catalog_pageAAAAAAAAABDAAAAA',271.89,0.00,102.33
'catalog channel','catalog_pageAAAAAAAAACBAAAAA',45271.27,0.00,-10610.43
'catalog channel','catalog_pageAAAAAAAAACDAAAAA',2390.88,0.00,-2864.36
'catalog channel','catalog_pageAAAAAAAAADBAAAAA',669.44,0.00,94.72
'catalog channel','catalog_pageAAAAAAAAADDAAAAA',15358.55,0.00,106.84
'catalog channel','catalog_pageAAAAAAAAAEBAAAAA',281.80,0.00,-453.95
'catalog channel','catalog_pageAAAAAAAAAEDAAAAA',18518.13,0.00,5728.56
'catalog channel','catalog_pageAAAAAAAAAFDAAAAA',16526.48,197.58,-1389.80
'catalog channel','catalog_pageAAAAAAAAAGDAAAAA',5929.11,0.00,-112.35
'catalog channel','catalog_pageAAAAAAAAAHAAAAAA',54503.95,3463.68,13965.89
'catalog channel','catalog_pageAAAAAAAAAIAAAAAA',2530.56,1003.03,-1026.80
'catalog channel','catalog_pageAAAAAAAAAJAAAAAA',40512.67,0.00,5695.91
'catalog channel','catalog_pageAAAAAAAAAKAAAAAA',18808.72,0.00,732.97
'catalog channel','catalog_pageAAAAAAAAALAAAAAA',28215.09,4112.81,-13640.89
'catalog channel','catalog_pageAAAAAAAAAMAAAAAA',32302.27,567.64,9530.88
'catalog channel','catalog_pageAAAAAAAAANAAAAAA',26198.95,3218.98,335.22
'catalog channel','catalog_pageAAAAAAAAANCAAAAA',3312.80,21.90,-1221.91
'catalog channel','catalog_pageAAAAAAAAAOAAAAAA',3178.52,544.26,-9162.40
'catalog channel','catalog_pageAAAAAAAAAOCAAAAA',1291.46,0.00,-1143.59
'catalog channel','catalog_pageAAAAAAAAAPAAAAAA',15502.68,1219.50,-1185.99
'catalog channel','catalog_pageAAAAAAAABABAAAAA',13412.36,0.00,1995.27
'catalog channel','catalog_pageAAAAAAAABADAAAAA',1352.54,0.00,-3327.72
'catalog channel','catalog_pageAAAAAAAABBBAAAAA',2900.78,0.00,-5454.12
'catalog channel','catalog_pageAAAAAAAABBDAAAAA',12345.38,0.00,-2224.86
'catalog channel','catalog_pageAAAAAAAABCBAAAAA',20.40,0.00,-512.20
'catalog channel','catalog_pageAAAAAAAABCDAAAAA',8753.94,97.46,-2000.56
'catalog channel','catalog_pageAAAAAAAABDBAAAAA',13505.86,0.00,-11090.53
'catalog channel','catalog_pageAAAAAAAABDDAAAAA',1170.19,0.00,-187.02
'catalog channel','catalog_pageAAAAAAAABEBAAAAA',27353.22,29.80,7942.47
'catalog channel','catalog_pageAAAAAAAABFDAAAAA',4484.91,0.00,-101.44
'catalog channel','catalog_pageAAAAAAAABHAAAAAA',12499.47,0.00,-5039.94
'catalog channel','catalog_pageAAAAAAAABIAAAAAA',27239.18,269.31,-1272.29
'catalog channel','catalog_pageAAAAAAAABJAAAAAA',27380.39,2428.52,-4449.84
'catalog channel','catalog_pageAAAAAAAABKAAAAAA',12323.62,1131.59,-9207.22
'catalog channel','catalog_pageAAAAAAAABKCAAAAA',726.00,0.00,-2502.06
'catalog channel','catalog_pageAAAAAAAABLAAAAAA',35217.83,0.00,12178.97
'catalog channel','catalog_pageAAAAAAAABLCAAAAA',416.58,0.00,-257.05
'catalog channel','catalog_pageAAAAAAAABMAAAAAA',29249.68,2447.46,-18367.34
'catalog channel','catalog_pageAAAAAAAABNAAAAAA',39939.39,11895.60,9443.01
'catalog channel','catalog_pageAAAAAAAABNCAAAAA',829.25,0.00,-432.14
'catalog channel','catalog_pageAAAAAAAABOAAAAAA',4776.55,645.29,-12353.36
'catalog channel','catalog_pageAAAAAAAABOCAAAAA',4132.80,3911.40,-502.34
'catalog channel','catalog_pageAAAAAAAABPAAAAAA',3780.14,0.00,-2369.55
'catalog channel','catalog_pageAAAAAAAACABAAAAA',13864.50,286.83,1568.92
'catalog channel','catalog_pageAAAAAAAACADAAAAA',5004.63,0.00,-2452.32
'catalog channel','catalog_pageAAAAAAAACBBAAAAA',5458.11,0.00,-2324.38
'catalog channel','catalog_pageAAAAAAAACBDAAAAA',7448.97,1110.56,-1789.38
'catalog channel','catalog_pageAAAAAAAACCBAAAAA',11176.44,0.00,-9025.80
'catalog channel','catalog_pageAAAAAAAACCDAAAAA',9009.45,0.00,-2737.84
'catalog channel','catalog_pageAAAAAAAACDBAAAAA',12882.97,0.00,-4257.79
'catalog channel','catalog_pageAAAAAAAACDDAAAAA',2039.06,429.36,-620.74
'catalog channel','catalog_pageAAAAAAAACEBAAAAA',5189.62,508.68,-4592.89
'catalog channel','catalog_pageAAAAAAAACEDAAAAA',11068.07,0.00,-828.38
'catalog channel','catalog_pageAAAAAAAACFDAAAAA',861.40,0.00,223.80
'catalog channel','catalog_pageAAAAAAAACHAAAAAA',16829.91,2360.82,-4144.50
'catalog channel','catalog_pageAAAAAAAACIAAAAAA',36094.60,0.00,797.28
'catalog channel','catalog_pageAAAAAAAACJAAAAAA',16513.90,0.00,-2482.24
'catalog channel','catalog_pageAAAAAAAACKAAAAAA',20101.46,18.52,-12781.69
'catalog channel','catalog_pageAAAAAAAACLAAAAAA',6942.39,0.00,-2652.10
'catalog channel','catalog_pageAAAAAAAACLCAAAAA',4435.30,2478.55,1582.13
'catalog channel','catalog_pageAAAAAAAACMAAAAAA',10339.92,714.59,-3810.28
'catalog channel','catalog_pageAAAAAAAACNAAAAAA',24171.31,219.63,-6876.07
'catalog channel','catalog_pageAAAAAAAACOAAAAAA',13386.50,51.66,-7675.85
'catalog channel','catalog_pageAAAAAAAACPAAAAAA',6673.28,170.28,1669.79
'catalog channel','catalog_pageAAAAAAAACPCAAAAA',4929.64,0.00,-4073.43
'catalog channel','catalog_pageAAAAAAAADABAAAAA',17341.07,0.00,2722.99
'catalog channel','catalog_pageAAAAAAAADADAAAAA',32122.29,0.00,13409.04
'catalog channel','catalog_pageAAAAAAAADBBAAAAA',29586.90,1697.61,8235.35
'catalog channel','catalog_pageAAAAAAAADBDAAAAA',3357.38,0.00,702.69
'catalog channel','catalog_pageAAAAAAAADCBAAAAA',5549.77,66.06,-2859.07
'catalog channel','catalog_pageAAAAAAAADCDAAAAA',3286.08,0.00,753.55
'catalog channel','catalog_pageAAAAAAAADDBAAAAA',3698.78,0.00,-8553.47
'catalog channel','catalog_pageAAAAAAAADDDAAAAA',1939.50,0.00,-3540.68
'catalog channel','catalog_pageAAAAAAAADEBAAAAA',3836.53,0.00,-3502.31
'catalog channel','catalog_pageAAAAAAAADEDAAAAA',18565.37,2379.24,2082.84
'catalog channel','catalog_pageAAAAAAAADFDAAAAA',14363.88,76.05,7598.96
'catalog channel','catalog_pageAAAAAAAADHAAAAAA',9513.67,0.00,-786.64
'catalog channel','catalog_pageAAAAAAAADIAAAAAA',37019.24,0.00,2227.96
'catalog channel','catalog_pageAAAAAAAADJAAAAAA',23475.03,4540.20,2173.17
'catalog channel','catalog_pageAAAAAAAADKAAAAAA',18901.65,0.00,3918.05
'catalog channel','catalog_pageAAAAAAAADLAAAAAA',28825.95,566.80,-9241.85
'catalog channel','catalog_pageAAAAAAAADMAAAAAA',40676.08,1322.46,-6120.84
'catalog channel','catalog_pageAAAAAAAADNAAAAAA',28061.92,109.98,-1584.13
'catalog channel','catalog_pageAAAAAAAADOAAAAAA',6751.41,0.00,-1356.88
'catalog channel','catalog_pageAAAAAAAADOCAAAAA',5190.10,0.00,-238.00
'catalog channel','catalog_pageAAAAAAAADPAAAAAA',10347.89,0.00,-7517.40
'catalog channel','catalog_pageAAAAAAAAEABAAAAA',22553.74,10270.04,-7133.94
'catalog channel','catalog_pageAAAAAAAAEADAAAAA',2807.40,0.00,-1325.01
'catalog channel','catalog_pageAAAAAAAAEBBAAAAA',3230.69,0.00,-4409.06
'catalog channel','catalog_pageAAAAAAAAEBDAAAAA',11651.24,0.00,-8437.86
'catalog channel','catalog_pageAAAAAAAAECBAAAAA',23100.03,0.00,4471.83
'catalog channel','catalog_pageAAAAAAAAECDAAAAA',580.53,0.00,-5204.99
'catalog channel','catalog_pageAAAAAAAAEDBAAAAA',11601.95,2958.72,-5116.64
'catalog channel','catalog_pageAAAAAAAAEDDAAAAA',20014.23,7330.00,-3652.86
'catalog channel','catalog_pageAAAAAAAAEEBAAAAA',19857.72,0.00,5511.15
'catalog channel','catalog_pageAAAAAAAAEEDAAAAA',8554.80,0.00,-10166.86
'catalog channel','catalog_pageAAAAAAAAEFDAAAAA',38432.66,11077.80,10213.68
---- TYPES
STRING, STRING, DECIMAL, DECIMAL, DECIMAL
====
