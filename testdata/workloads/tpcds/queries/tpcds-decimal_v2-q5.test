====
---- QUERY: TPCDS-Q5
with ssr as
 (select s_store_id,
        sum(sales_price) as sales,
        sum(profit) as profit,
        sum(return_amt) as `returns`,
        sum(net_loss) as profit_loss
 from
  ( select  ss_store_sk as store_sk,
            ss_sold_date_sk  as date_sk,
            ss_ext_sales_price as sales_price,
            ss_net_profit as profit,
            cast(0 as decimal(7,2)) as return_amt,
            cast(0 as decimal(7,2)) as net_loss
    from store_sales
    union all
    select sr_store_sk as store_sk,
           sr_returned_date_sk as date_sk,
           cast(0 as decimal(7,2)) as sales_price,
           cast(0 as decimal(7,2)) as profit,
           sr_return_amt as return_amt,
           sr_net_loss as net_loss
    from store_returns
   ) salesreturns,
     date_dim,
     store
 where date_sk = d_date_sk
       and d_date between cast('1998-08-04' as date)
                  and (cast('1998-08-04' as date) +  INTERVAL 14 days)
       and store_sk = s_store_sk
 group by s_store_id)
 ,
 csr as
 (select cp_catalog_page_id,
        sum(sales_price) as sales,
        sum(profit) as profit,
        sum(return_amt) as `returns`,
        sum(net_loss) as profit_loss
 from
  ( select  cs_catalog_page_sk as page_sk,
            cs_sold_date_sk  as date_sk,
            cs_ext_sales_price as sales_price,
            cs_net_profit as profit,
            cast(0 as decimal(7,2)) as return_amt,
            cast(0 as decimal(7,2)) as net_loss
    from catalog_sales
    union all
    select cr_catalog_page_sk as page_sk,
           cr_returned_date_sk as date_sk,
           cast(0 as decimal(7,2)) as sales_price,
           cast(0 as decimal(7,2)) as profit,
           cr_return_amount as return_amt,
           cr_net_loss as net_loss
    from catalog_returns
   ) salesreturns,
     date_dim,
     catalog_page
 where date_sk = d_date_sk
       and d_date between cast('1998-08-04' as date)
                  and (cast('1998-08-04' as date) +  INTERVAL 14 days)
       and page_sk = cp_catalog_page_sk
 group by cp_catalog_page_id)
 ,
 wsr as
 (select web_site_id,
        sum(sales_price) as sales,
        sum(profit) as profit,
        sum(return_amt) as `returns`,
        sum(net_loss) as profit_loss
 from
  ( select  ws_web_site_sk as wsr_web_site_sk,
            ws_sold_date_sk  as date_sk,
            ws_ext_sales_price as sales_price,
            ws_net_profit as profit,
            cast(0 as decimal(7,2)) as return_amt,
            cast(0 as decimal(7,2)) as net_loss
    from web_sales
    union all
    select ws_web_site_sk as wsr_web_site_sk,
           wr_returned_date_sk as date_sk,
           cast(0 as decimal(7,2)) as sales_price,
           cast(0 as decimal(7,2)) as profit,
           wr_return_amt as return_amt,
           wr_net_loss as net_loss
    from web_returns left outer join web_sales on
         ( wr_item_sk = ws_item_sk
           and wr_order_number = ws_order_number)
   ) salesreturns,
     date_dim,
     web_site
 where date_sk = d_date_sk
       and d_date between cast('1998-08-04' as date)
                  and (cast('1998-08-04' as date) +  INTERVAL 14 days)
       and wsr_web_site_sk = web_site_sk
 group by web_site_id)
  select  channel
        , id
        , sum(sales) as sales
        , sum(`returns`) as `returns`
        , sum(profit) as profit
 from
 (select 'store channel' as channel
        , 'store' || s_store_id as id
        , sales
        , `returns`
        , (profit - profit_loss) as profit
 from   ssr
 union all
 select 'catalog channel' as channel
        , 'catalog_page' || cp_catalog_page_id as id
        , sales
        , `returns`
        , (profit - profit_loss) as profit
 from  csr
 union all
 select 'web channel' as channel
        , 'web_site' || web_site_id as id
        , sales
        , `returns`
        , (profit - profit_loss) as profit
 from   wsr
 ) x
 group by rollup (channel, id)
 order by channel
         ,id
 limit 100;
---- RESULTS
'catalog channel','catalog_pageAAAAAAAAAABAAAAA',73724.99,0.00,-34506.26
'catalog channel','catalog_pageAAAAAAAAAADAAAAA',73182.60,0.00,-17828.06
'catalog channel','catalog_pageAAAAAAAAABAAAAAA',0.00,4543.46,-2785.79
'catalog channel','catalog_pageAAAAAAAAABBAAAAA',72671.60,0.00,6590.95
'catalog channel','catalog_pageAAAAAAAAABCAAAAA',0.00,3646.32,-514.18
'catalog channel','catalog_pageAAAAAAAAABDAAAAA',69548.37,0.00,-6749.40
'catalog channel','catalog_pageAAAAAAAAACAAAAAA',0.00,10499.54,-5521.37
'catalog channel','catalog_pageAAAAAAAAACBAAAAA',153295.93,5351.63,4632.81
'catalog channel','catalog_pageAAAAAAAAACDAAAAA',54336.42,0.00,-18212.06
'catalog channel','catalog_pageAAAAAAAAADAAAAAA',0.00,9992.13,-6117.85
'catalog channel','catalog_pageAAAAAAAAADBAAAAA',131954.65,50.05,5527.80
'catalog channel','catalog_pageAAAAAAAAADDAAAAA',76814.28,0.00,-3457.30
'catalog channel','catalog_pageAAAAAAAAAEAAAAAA',0.00,3197.25,-478.68
'catalog channel','catalog_pageAAAAAAAAAEBAAAAA',92714.17,0.00,10984.25
'catalog channel','catalog_pageAAAAAAAAAECAAAAA',0.00,2249.75,-1759.52
'catalog channel','catalog_pageAAAAAAAAAEDAAAAA',74886.06,0.00,12438.42
'catalog channel','catalog_pageAAAAAAAAAFAAAAAA',0.00,7425.07,-4953.73
'catalog channel','catalog_pageAAAAAAAAAFDAAAAA',68271.10,0.00,-31349.03
'catalog channel','catalog_pageAAAAAAAAAGAAAAAA',0.00,30.69,-114.52
'catalog channel','catalog_pageAAAAAAAAAGBAAAAA',0.00,152.10,-232.54
'catalog channel','catalog_pageAAAAAAAAAGCAAAAA',0.00,907.94,-259.69
'catalog channel','catalog_pageAAAAAAAAAGDAAAAA',80839.26,0.00,-17596.72
'catalog channel','catalog_pageAAAAAAAAAHAAAAAA',183580.58,3667.05,-30239.38
'catalog channel','catalog_pageAAAAAAAAAIAAAAAA',176232.57,130.41,-14554.63
'catalog channel','catalog_pageAAAAAAAAAIBAAAAA',0.00,267.00,-180.11
'catalog channel','catalog_pageAAAAAAAAAJAAAAAA',200218.67,1441.64,41.78
'catalog channel','catalog_pageAAAAAAAAAJCAAAAA',21707.46,0.00,-2111.35
'catalog channel','catalog_pageAAAAAAAAAKAAAAAA',142031.14,0.00,-26852.79
'catalog channel','catalog_pageAAAAAAAAAKCAAAAA',15995.65,0.00,-1934.05
'catalog channel','catalog_pageAAAAAAAAALAAAAAA',126857.88,9.78,-44236.00
'catalog channel','catalog_pageAAAAAAAAALBAAAAA',0.00,NULL,-508.20
'catalog channel','catalog_pageAAAAAAAAALCAAAAA',21479.91,0.00,-8594.75
'catalog channel','catalog_pageAAAAAAAAAMAAAAAA',169425.57,2291.31,-37705.18
'catalog channel','catalog_pageAAAAAAAAAMCAAAAA',14310.85,0.00,-21009.49
'catalog channel','catalog_pageAAAAAAAAANAAAAAA',198016.35,273.78,-14742.98
'catalog channel','catalog_pageAAAAAAAAANBAAAAA',0.00,490.00,-184.86
'catalog channel','catalog_pageAAAAAAAAANCAAAAA',29918.97,0.00,-4040.58
'catalog channel','catalog_pageAAAAAAAAAOAAAAAA',105854.60,0.00,-8874.12
'catalog channel','catalog_pageAAAAAAAAAOCAAAAA',14091.48,0.00,-1309.14
'catalog channel','catalog_pageAAAAAAAAAPAAAAAA',83006.94,0.00,-5381.07
'catalog channel','catalog_pageAAAAAAAAAPCAAAAA',37508.18,0.00,-7290.39
'catalog channel','catalog_pageAAAAAAAABAAAAAAA',0.00,1107.33,-960.08
'catalog channel','catalog_pageAAAAAAAABABAAAAA',95905.45,0.00,-13710.06
'catalog channel','catalog_pageAAAAAAAABADAAAAA',47636.96,0.00,-28573.24
'catalog channel','catalog_pageAAAAAAAABBAAAAAA',0.00,2623.04,-1015.94
'catalog channel','catalog_pageAAAAAAAABBBAAAAA',58354.38,0.00,-10624.68
'catalog channel','catalog_pageAAAAAAAABBDAAAAA',49780.88,0.00,-11981.01
'catalog channel','catalog_pageAAAAAAAABCAAAAAA',0.00,4125.66,-1523.65
'catalog channel','catalog_pageAAAAAAAABCBAAAAA',98660.80,0.00,-16289.71
'catalog channel','catalog_pageAAAAAAAABCDAAAAA',113374.11,0.00,-19319.37
'catalog channel','catalog_pageAAAAAAAABDAAAAAA',0.00,180.96,-303.56
'catalog channel','catalog_pageAAAAAAAABDBAAAAA',58175.73,380.96,555.42
'catalog channel','catalog_pageAAAAAAAABDDAAAAA',49788.84,0.00,-35531.15
'catalog channel','catalog_pageAAAAAAAABEAAAAAA',0.00,4989.69,-1347.21
'catalog channel','catalog_pageAAAAAAAABEBAAAAA',77142.64,0.00,2181.34
'catalog channel','catalog_pageAAAAAAAABEDAAAAA',37722.95,0.00,-3862.61
'catalog channel','catalog_pageAAAAAAAABFAAAAAA',0.00,1134.57,-2249.74
'catalog channel','catalog_pageAAAAAAAABFDAAAAA',90245.96,0.00,8274.06
'catalog channel','catalog_pageAAAAAAAABGAAAAAA',0.00,9836.43,-6219.61
'catalog channel','catalog_pageAAAAAAAABGBAAAAA',0.00,60.03,-337.81
'catalog channel','catalog_pageAAAAAAAABHAAAAAA',211801.76,0.00,-18883.07
'catalog channel','catalog_pageAAAAAAAABHCAAAAA',0.00,2809.62,-969.29
'catalog channel','catalog_pageAAAAAAAABIAAAAAA',175304.26,0.00,-5063.68
'catalog channel','catalog_pageAAAAAAAABJAAAAAA',192257.13,2641.12,4494.09
'catalog channel','catalog_pageAAAAAAAABJCAAAAA',21066.11,0.00,-9792.90
'catalog channel','catalog_pageAAAAAAAABKAAAAAA',117310.09,0.00,-38423.34
'catalog channel','catalog_pageAAAAAAAABKCAAAAA',16351.27,0.00,970.92
'catalog channel','catalog_pageAAAAAAAABLAAAAAA',189060.69,0.00,-27541.44
'catalog channel','catalog_pageAAAAAAAABLCAAAAA',11111.58,0.00,2786.73
'catalog channel','catalog_pageAAAAAAAABMAAAAAA',148581.54,1047.69,-39546.35
'catalog channel','catalog_pageAAAAAAAABMCAAAAA',5756.80,0.00,961.53
'catalog channel','catalog_pageAAAAAAAABNAAAAAA',210427.91,404.72,-17396.64
'catalog channel','catalog_pageAAAAAAAABNCAAAAA',11474.87,0.00,-6101.47
'catalog channel','catalog_pageAAAAAAAABOAAAAAA',85328.52,0.00,-13566.80
'catalog channel','catalog_pageAAAAAAAABOCAAAAA',8991.73,0.00,-9799.23
'catalog channel','catalog_pageAAAAAAAABPAAAAAA',67031.90,228.48,-17054.88
'catalog channel','catalog_pageAAAAAAAABPCAAAAA',3184.57,0.00,-1553.07
'catalog channel','catalog_pageAAAAAAAACAAAAAAA',0.00,594.69,-910.16
'catalog channel','catalog_pageAAAAAAAACABAAAAA',68609.89,0.00,-2362.92
'catalog channel','catalog_pageAAAAAAAACADAAAAA',97819.48,0.00,3615.65
'catalog channel','catalog_pageAAAAAAAACBAAAAAA',0.00,4531.07,-864.84
'catalog channel','catalog_pageAAAAAAAACBBAAAAA',87577.40,5163.40,-23331.95
'catalog channel','catalog_pageAAAAAAAACBDAAAAA',65509.70,0.00,-26490.01
'catalog channel','catalog_pageAAAAAAAACCAAAAAA',0.00,579.28,-263.33
'catalog channel','catalog_pageAAAAAAAACCBAAAAA',79097.22,0.00,-14175.57
'catalog channel','catalog_pageAAAAAAAACCCAAAAA',0.00,107.64,-110.70
'catalog channel','catalog_pageAAAAAAAACCDAAAAA',94846.27,0.00,2494.45
'catalog channel','catalog_pageAAAAAAAACDAAAAAA',0.00,3583.50,-5705.10
'catalog channel','catalog_pageAAAAAAAACDBAAAAA',78115.95,0.00,-10896.38
'catalog channel','catalog_pageAAAAAAAACDCAAAAA',0.00,793.44,-78.49
'catalog channel','catalog_pageAAAAAAAACDDAAAAA',102043.84,0.00,-3411.73
'catalog channel','catalog_pageAAAAAAAACEBAAAAA',80630.55,0.00,-37508.78
'catalog channel','catalog_pageAAAAAAAACECAAAAA',0.00,505.73,-398.47
'catalog channel','catalog_pageAAAAAAAACEDAAAAA',144185.84,0.00,23612.84
'catalog channel','catalog_pageAAAAAAAACFAAAAAA',0.00,2046.36,-1765.63
'catalog channel','catalog_pageAAAAAAAACFDAAAAA',87318.92,0.00,22201.70
'catalog channel','catalog_pageAAAAAAAACGAAAAAA',0.00,1401.84,-382.86
'catalog channel','catalog_pageAAAAAAAACGCAAAAA',0.00,498.96,-311.43
'catalog channel','catalog_pageAAAAAAAACHAAAAAA',198097.84,0.00,-171.05
'catalog channel','catalog_pageAAAAAAAACIAAAAAA',170669.13,0.00,-28180.55
---- TYPES
STRING, STRING, DECIMAL, DECIMAL, DECIMAL
====
