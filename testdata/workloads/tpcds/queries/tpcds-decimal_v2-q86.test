====
---- QUERY: TPCDS-Q86
select
    sum(ws_net_paid) as total_sum
   ,i_category
   ,i_class
   ,grouping(i_category)+grouping(i_class) as lochierarchy
   ,rank() over (
        partition by grouping(i_category)+grouping(i_class),
        case when grouping(i_class) = 0 then i_category end
        order by sum(ws_net_paid) desc) as rank_within_parent
 from
    web_sales
   ,date_dim       d1
   ,item
 where
    d1.d_month_seq between 1212 and 1212+11
 and d1.d_date_sk = ws_sold_date_sk
 and i_item_sk  = ws_item_sk
 group by rollup(i_category,i_class)
 order by
   lochierarchy desc,
  -- Modified from original because Impala does not allow aliases within order by
  -- expressions, except at the top level.
   case when grouping(i_category)+grouping(i_class) = 0 then i_category end,
   rank_within_parent
 limit 100;
---- RESULTS
335298083.49,'NULL','NULL',2,1
35668385.24,'Music','NULL',1,1
34110308.09,'Men','NULL',1,2
33945859.14,'Shoes','NULL',1,3
33779396.33,'Home','NULL',1,4
33660827.11,'Electronics','NULL',1,5
33471238.87,'Women','NULL',1,6
33048439.90,'Books','NULL',1,7
32553196.48,'Sports','NULL',1,8
32454111.82,'Children','NULL',1,9
31955775.63,'Jewelry','NULL',1,10
650544.88,'NULL','NULL',1,11
2603917.26,'Books','reference',0,1
2500411.13,'Books','history',0,2
2392291.39,'Books','computers',0,3
2278162.58,'Books','home repair',0,4
2264632.73,'Books','romance',0,5
2204536.79,'Books','fiction',0,6
2174686.53,'Books','travel',0,7
2101508.76,'Books','entertainments',0,8
2092734.81,'Books','parenting',0,9
2037140.80,'Books','sports',0,10
1920062.16,'Books','self-help',0,11
1791937.78,'Books','mystery',0,12
1747449.84,'Books','cooking',0,13
1744147.13,'Books','science',0,14
1629493.52,'Books','business',0,15
1535662.83,'Books','arts',0,16
29663.86,'Books','NULL',0,17
8427198.29,'Children','school-uniforms',0,1
8170040.55,'Children','infants',0,2
8030368.31,'Children','newborn',0,3
7772368.18,'Children','toddlers',0,4
54136.49,'Children','NULL',0,5
2665898.32,'Electronics','karoke',0,1
2647708.85,'Electronics','dvd/vcr players',0,2
2327655.83,'Electronics','audio',0,3
2320597.52,'Electronics','monitors',0,4
2252767.09,'Electronics','memory',0,5
2222688.75,'Electronics','personal',0,6
2094873.27,'Electronics','televisions',0,7
2060395.64,'Electronics','musical',0,8
2021383.60,'Electronics','portable',0,9
1960699.97,'Electronics','stereo',0,10
1955981.28,'Electronics','wireless',0,11
1931224.93,'Electronics','disk drives',0,12
1870348.87,'Electronics','cameras',0,13
1804127.22,'Electronics','scanners',0,14
1800889.53,'Electronics','automotive',0,15
1723586.44,'Electronics','camcorders',0,16
2678321.52,'Home','bedding',0,1
2544675.48,'Home','glassware',0,2
2454928.54,'Home','tables',0,3
2258540.99,'Home','curtains/drapes',0,4
2191949.77,'Home','lighting',0,5
2187564.96,'Home','wallpaper',0,6
2172959.94,'Home','flatware',0,7
2159059.95,'Home','decor',0,8
2056828.93,'Home','paint',0,9
2053061.41,'Home','rugs',0,10
1893240.65,'Home','kids',0,11
1856421.87,'Home','bathroom',0,12
1856300.04,'Home','furniture',0,13
1812963.47,'Home','blinds/shades',0,14
1780974.36,'Home','accent',0,15
1711990.64,'Home','mattresses',0,16
109613.81,'Home','NULL',0,17
2736956.17,'Jewelry','custom',0,1
2638200.54,'Jewelry','jewelry boxes',0,2
2279983.95,'Jewelry','bracelets',0,3
2154865.44,'Jewelry','womens watch',0,4
2140041.02,'Jewelry','rings',0,5
2093041.31,'Jewelry','costume',0,6
2088949.87,'Jewelry','pendants',0,7
1995895.68,'Jewelry','diamonds',0,8
1882780.88,'Jewelry','birdal',0,9
1852053.82,'Jewelry','gold',0,10
1817697.92,'Jewelry','mens watch',0,11
1731142.74,'Jewelry','estate',0,12
1713259.20,'Jewelry','earings',0,13
1697803.23,'Jewelry','loose stones',0,14
1606289.52,'Jewelry','semi-precious',0,15
1494189.90,'Jewelry','consignment',0,16
32624.44,'Jewelry','NULL',0,17
9606467.15,'Men','shirts',0,1
8471403.12,'Men','accessories',0,2
8354664.10,'Men','pants',0,3
7636055.87,'Men','sports-apparel',0,4
41717.85,'Men','NULL',0,5
9768150.20,'Music','country',0,1
9247280.12,'Music','classical',0,2
8872740.98,'Music','pop',0,3
7628414.40,'Music','rock',0,4
151799.54,'Music','NULL',0,5
9322023.00,'Shoes','mens',0,1
8773114.36,'Shoes','womens',0,2
8179271.60,'Shoes','athletic',0,3
7631585.15,'Shoes','kids',0,4
39865.03,'Shoes','NULL',0,5
2638814.24,'Sports','pools',0,1
---- TYPES
DECIMAL, STRING, STRING, SMALLINT, BIGINT
====
