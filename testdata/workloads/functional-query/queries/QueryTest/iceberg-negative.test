====
---- QUERY
CREATE TABLE iceberg_test1
STORED AS ICEBERG;
---- CATCH
AnalysisException: Table requires at least 1 column for managed iceberg table.
====
---- QUERY
CREATE TABLE iceberg_test2(
  level STRING
)
PARTITION BY SPEC
(
  level IDENTITY,
  event_time HOUR
)
STORED AS ICEBERG;
---- CATCH
AnalysisException: Cannot find source column: event_time
====
---- QUERY
CREATE TABLE iceberg_test3(
  level STRING
)
STORED AS ICEBERG
TBLPROPERTIES('iceberg.catalog'='hadoop.tables');
====
---- QUERY
TRUNCATE iceberg_test3
---- CATCH
AnalysisException: TRUNCATE TABLE not supported on iceberg table: $DATABASE.iceberg_test3
====
---- QUERY
ALTER TABLE iceberg_test3 ADD COLUMN event_time TIMESTAMP
---- CATCH
AnalysisException: ALTER TABLE not allowed on iceberg table: iceberg_test3
====
---- QUERY
# iceberg_non_partitioned is not partitioned
SHOW PARTITIONS functional_parquet.iceberg_non_partitioned
---- CATCH
AnalysisException: Table is not partitioned: functional_parquet.iceberg_non_partitioned
====
---- QUERY
CREATE TABLE iceberg_test4(
  level STRING
)
STORED AS ICEBERG
LOCATION '/test-warehouse/$DATABASE/hadoop_catalog_test/iceberg_test'
TBLPROPERTIES('iceberg.catalog'='hadoop.catalog');
---- CATCH
AnalysisException: Location cannot be set for Iceberg table with 'hadoop.catalog'.
====
---- QUERY
CREATE TABLE iceberg_test5(
  level STRING
)
STORED AS ICEBERG
TBLPROPERTIES('iceberg.catalog'='hadoop.catalog');
---- CATCH
AnalysisException: Table property 'iceberg.catalog_location' is necessary for Iceberg table with 'hadoop.catalog'.
====
---- QUERY
CREATE EXTERNAL TABLE iceberg_test6
STORED AS ICEBERG
LOCATION '/test-warehouse/$DATABASE/hadoop_catalog_test/iceberg_test'
TBLPROPERTIES('iceberg.catalog_location'='/test-warehouse/fake_table', 'iceberg.table_identifier'='fake_db.fake_table');
---- CATCH
AnalysisException: Location cannot be set for Iceberg table with 'hadoop.catalog'.
====
---- QUERY
CREATE EXTERNAL TABLE iceberg_test7
STORED AS ICEBERG
TBLPROPERTIES('iceberg.table_identifier'='fake_db.fake_table');
---- CATCH
AnalysisException: Table property 'iceberg.catalog_location' is necessary for Iceberg table with 'hadoop.catalog'.
====
---- QUERY
CREATE EXTERNAL TABLE iceberg_test8
STORED AS ICEBERG
TBLPROPERTIES('iceberg.catalog_location'='/test-warehouse/fake_table', 'iceberg.table_identifier'='fake_db.fake_table');
SHOW CREATE TABLE iceberg_test8;
---- CATCH
row_regex:.*CAUSED BY: TableLoadingException: Table does not exist: fake_db.fake_table*
====
---- QUERY
CREATE TABLE iceberg_ctas
STORED AS ICEBERG
TBLPROPERTIES('iceberg.catalog'='hadoop.tables')
AS SELECT id FROM functional.alltypes;
---- CATCH
AnalysisException: CREATE TABLE AS SELECT does not support the (ICEBERG) file format.
====
---- QUERY
CREATE TABLE iceberg_overwrite (i int)
STORED AS ICEBERG
TBLPROPERTIES('iceberg.catalog'='hadoop.tables');
INSERT OVERWRITE iceberg_overwrite VALUES (1), (2), (3);
---- CATCH
AnalysisException: INSERT OVERWRITE not supported for Iceberg tables.
====
---- QUERY
CREATE TABLE iceberg_partitioned_insert(
  level STRING,
  event_time TIMESTAMP
)
PARTITION BY SPEC
(
  level IDENTITY
)
STORED AS ICEBERG
TBLPROPERTIES('iceberg.catalog'='hadoop.tables');
---- RESULTS
'Table has been created.'
====
---- QUERY
INSERT INTO iceberg_partitioned_insert SELECT * FROM iceberg_partitioned_insert;
---- CATCH
AnalysisException: Impala cannot write partitioned Iceberg tables.
====
