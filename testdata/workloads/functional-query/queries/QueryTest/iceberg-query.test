====
---- QUERY
# IMPALA-9741: Support querying Iceberg table by impala
SELECT count(*) from iceberg_partitioned;
---- TYPES
bigint
---- RESULTS
20
====
---- QUERY
SELECT count(*) from iceberg_non_partitioned
---- TYPES
bigint
---- RESULTS
20
====
---- QUERY
# Test non partition column filter count
SELECT count(*) from iceberg_partitioned
where id > 10
---- TYPES
bigint
---- RESULTS
10
====
---- QUERY
SELECT count(*) from iceberg_non_partitioned
where id > 10
---- TYPES
bigint
---- RESULTS
10
====
---- QUERY
# Test partition column filter count
SELECT count(*) from iceberg_partitioned
where action <> 'click'
---- TYPES
bigint
---- RESULTS
14
====
---- QUERY
SELECT count(*) from iceberg_non_partitioned
where action = 'click'
---- TYPES
bigint
---- RESULTS
6
====
---- QUERY
# Test distinct count
SELECT count(distinct id),count(distinct action) from iceberg_partitioned
---- TYPES
bigint,bigint
---- RESULTS
20,3
====
---- QUERY
SELECT count(distinct id),count(distinct action) from iceberg_non_partitioned
---- TYPES
bigint,bigint
---- RESULTS
20,3
====
---- QUERY
# Test timestamp filter for iceberg derived partition 'HOUR'
SET TIMEZONE=UTC;
SELECT count(*) from iceberg_partitioned
where event_time > to_timestamp('2020-01-01 09:00:00','yyyy-MM-dd HH:mm:ss')
---- TYPES
bigint
---- RESULTS
6
====
---- QUERY
SET TIMEZONE=UTC;
SELECT count(*) from iceberg_non_partitioned
where event_time > to_timestamp('2020-01-01 09:00:00','yyyy-MM-dd HH:mm:ss')
---- TYPES
bigint
---- RESULTS
6
====
---- QUERY
# Test non-count query for partition filter
SET TIMEZONE=UTC;
SELECT * from iceberg_partitioned
where event_time > to_timestamp('2020-01-01 09:00:00','yyyy-MM-dd HH:mm:ss')
ORDER BY id
---- TYPES
int,string,string,timestamp
---- RESULTS
2,'Lisa','download',2020-01-01 10:00:00
5,'Lisa','download',2020-01-01 10:00:00
7,'Lisa','download',2020-01-01 10:00:00
8,'Lisa','download',2020-01-01 10:00:00
14,'Lisa','download',2020-01-01 10:00:00
16,'Lisa','download',2020-01-01 10:00:00
====
---- QUERY
# Test non-count query for non-partition filter
SET TIMEZONE=UTC;
SELECT * from iceberg_non_partitioned
where id < 5
ORDER BY id
---- TYPES
int,string,string,timestamp
---- RESULTS
1,'Alex','view',2020-01-01 08:00:00
2,'Lisa','download',2020-01-01 10:00:00
3,'Alan','click',2020-01-01 09:00:00
4,'Alex','view',2020-01-01 08:00:00
====
---- QUERY
# Test show partitions query for iceberg table
SHOW PARTITIONS iceberg_partitioned
---- TYPES
string,bigint,bigint
---- RESULTS
'{"event_time_hour":"438296","action":"view"}',8,8
'{"event_time_hour":"438297","action":"click"}',6,6
'{"event_time_hour":"438298","action":"download"}',6,6
====
---- QUERY
SHOW FILES in iceberg_partitioned
---- LABELS
Path,Size,Partition,EC Policy
---- RESULTS
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-08/action=view/00001-1-b975a171-0911-47c2-90c8-300f23c28772-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-08/action=view/00006-6-9bc6f547-de52-4aad-8c07-5d0f1aaa0558-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-08/action=view/00009-9-bf3024d6-8b55-42d3-b25e-5f2a31303026-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-08/action=view/00017-17-a0d23269-c8d7-40cf-94c8-8b624969b9c0-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-08/action=view/00023-23-138a376e-696e-4da3-95f3-7e0aacb11ca3-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-08/action=view/00027-27-04494175-75de-41ef-b824-3923ebfba0cb-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-08/action=view/00030-30-eba34050-b263-41e8-bc7d-773a47b33c32-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-08/action=view/00031-31-0ec1c3ff-7154-4fd1-a090-8fa0b9c2d3c8-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-09/action=click/00004-4-8b99da05-6be1-42e1-90e0-bff8ca08b5af-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-09/action=click/00014-14-5b39012d-85e3-4144-ac83-574ed5046718-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-09/action=click/00015-15-e37e3f98-5f3b-4245-9c01-76cf0f1dd21a-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-09/action=click/00019-19-e36a1955-f01c-4e08-9f19-dcec0cbceadd-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-09/action=click/00020-20-c9632a29-fd5b-4ba5-a0db-2992c73075c2-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-09/action=click/00028-28-31220e43-f85a-4609-9ebb-4c76269cddb6-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-10/action=download/00003-3-7e47d440-44f5-4a11-bbfa-c72c520ca997-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-10/action=download/00007-7-c902540c-b002-413c-b422-7ec3c06d404e-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-10/action=download/00011-11-5558f0e5-7a46-417e-8c0a-50bb00e54a30-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-10/action=download/00012-12-ea94b7c7-164d-4d06-8b4d-24d296906f73-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-10/action=download/00022-22-0565b9eb-060d-4180-aa1e-2bb69187d8db-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned/data/event_time_hour=2020-01-01-10/action=download/00025-25-1f2b05c6-5407-41fc-a881-60626253ca77-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
---- TYPES
STRING,STRING,STRING,STRING
====
---- QUERY
SHOW FILES in iceberg_non_partitioned
---- LABELS
Path,Size,Partition,EC Policy
---- RESULTS
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00001-1-5dbd44ad-18bc-40f2-9dd6-aeb2cc23457c-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00003-3-27db2521-1e8b-40c1-b846-552cd620abce-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00004-4-f1b55628-0544-4833-8b11-1b4add53dfd6-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00006-6-f75530ef-93b6-4994-b3c8-db957d44848c-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00007-7-8d9b22da-5f10-4cbf-8e4d-160f829b5e48-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00009-9-f029a1f7-9024-4bc3-a030-e20861586146-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00011-11-f07814ae-56cd-486b-af81-18541437da7d-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00012-12-967c70a4-bf4d-4a82-8c97-c90e2b4d9dcf-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00014-14-d0cdca7f-c050-407e-b70c-2bd076f83e4e-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00015-15-0e931a1f-309e-43b3-a5cf-3ef82fa4a87c-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00017-17-43138078-244c-4b38-8127-04a5bfbc4695-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00019-19-52569895-df25-4ad8-b64d-49c4540d36c9-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00020-20-f160c1ea-a2f5-4109-81ec-3ff9c155430f-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00022-22-c1f61b8c-9d9a-4823-b64e-109770c16696-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00023-23-8cfc9d65-bfc3-47c4-8da7-6610b49b3305-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00025-25-d519b09d-c730-40a6-ad03-8b36096cb234-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00027-27-802b2129-0d18-418a-bcdd-b1b5332ea2a5-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00028-28-70f51a0c-3d30-4cdb-afcb-e8c1cfa3caa4-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00030-30-e887707d-58db-469c-ab96-b77188f25189-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned/data/00031-31-facf6a62-c326-44f7-bdc3-b1471bd594d7-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
---- TYPES
STRING,STRING,STRING,STRING
====
---- QUERY
SELECT count(*) from hadoop_catalog_test_external
---- TYPES
bigint
---- RESULTS
20
====
---- QUERY
SELECT count(*) from hadoop_catalog_test_external
where id > 10
---- TYPES
bigint
---- RESULTS
10
====
---- QUERY
SELECT count(*) from hadoop_catalog_test_external
where action <> 'click'
---- TYPES
bigint
---- RESULTS
14
---- QUERY
SELECT count(distinct id),count(distinct action) from hadoop_catalog_test_external
---- TYPES
bigint,bigint
---- RESULTS
20,3
====
---- QUERY
SET TIMEZONE=UTC;
SELECT count(*) from hadoop_catalog_test_external
where event_time > to_timestamp('2020-01-01 09:00:00','yyyy-MM-dd HH:mm:ss')
---- TYPES
bigint
---- RESULTS
6
====
---- QUERY
SET TIMEZONE=UTC;
SELECT * from hadoop_catalog_test_external
where event_time > to_timestamp('2020-01-01 09:00:00','yyyy-MM-dd HH:mm:ss')
ORDER BY id
---- TYPES
int,string,string,timestamp
---- RESULTS
2,'Lisa','download',2020-01-01 10:00:00
5,'Lisa','download',2020-01-01 10:00:00
7,'Lisa','download',2020-01-01 10:00:00
8,'Lisa','download',2020-01-01 10:00:00
14,'Lisa','download',2020-01-01 10:00:00
16,'Lisa','download',2020-01-01 10:00:00
====
---- QUERY
SHOW PARTITIONS hadoop_catalog_test_external
---- TYPES
string,bigint,bigint
---- RESULTS
'{"event_time_hour":"438296","action":"view"}',8,8
'{"event_time_hour":"438297","action":"click"}',6,6
'{"event_time_hour":"438298","action":"download"}',6,6
====
---- QUERY
SHOW FILES in hadoop_catalog_test_external
---- LABELS
Path,Size,Partition,EC Policy
---- RESULTS
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-08/action=view/00001-1-bc402da0-b562-4310-9001-06f9b6b0f9ae-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-08/action=view/00006-6-d253aefa-65fc-4698-8f26-b155fc965cf6-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-08/action=view/00009-9-5d04b016-05e1-43fc-b4a0-0e0df52a5035-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-08/action=view/00017-17-20b92523-c3b9-401d-b429-363c245dbe9c-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-08/action=view/00023-23-c86370cf-10a1-4e49-86dc-b094fe739aa6-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-08/action=view/00027-27-f32f86fa-286f-4cd3-8337-98685c48176d-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-08/action=view/00030-30-b18d2bbc-46a2-4040-a4a8-7488447de3b6-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-08/action=view/00031-31-c9bda250-ed1c-4868-bbf1-f2aad65fa80c-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-09/action=click/00004-4-0ed77823-ded1-4a12-9e03-4027cd43966a-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-09/action=click/00014-14-f698d7a4-245f-44d5-8a59-ed511854c8f8-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-09/action=click/00015-15-7c1d5490-91f7-47bd-a3b6-e86caa7fe47d-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-09/action=click/00019-19-d2ef5fcf-4346-421f-b2ef-1f9d55fb4c84-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-09/action=click/00020-20-a70c64ed-7a99-4f43-ada7-225c92f6a993-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-09/action=click/00028-28-bb02c862-3d63-42cb-8041-0a0b14b8ca13-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-10/action=download/00003-3-d5288e68-c862-4248-b3e5-84228a3ec39d-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-10/action=download/00007-7-92031dc0-b7eb-424d-9edb-dd2cedc59784-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-10/action=download/00011-11-9361e5f3-cfa7-4190-bb30-0db1d53202fd-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-10/action=download/00012-12-e82b52b1-dc5b-4417-81b7-8e9fd992280b-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-10/action=download/00022-22-c646ba9a-9387-4c38-bab8-a0598c400fde-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test/data/event_time_hour=2020-01-01-10/action=download/00025-25-7f8283a3-b39f-4273-984b-cf7faf39dd9d-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
---- TYPES
STRING,STRING,STRING,STRING
====
---- QUERY
SELECT count(*) from iceberg_partitioned_orc_external;
---- TYPES
bigint
---- RESULTS
20
====
---- QUERY
SELECT count(*) from iceberg_partitioned_orc_external
where id > 10
---- TYPES
bigint
---- RESULTS
10
====
---- QUERY
SELECT count(*) from iceberg_partitioned_orc_external
where action <> 'click'
---- TYPES
bigint
---- RESULTS
14
====
---- QUERY
# Test distinct count
SELECT count(distinct id),count(distinct action) from iceberg_partitioned_orc_external
---- TYPES
bigint,bigint
---- RESULTS
20,3
====
---- QUERY
SELECT * from iceberg_partitioned_orc_external
where id < 5
ORDER BY id
---- TYPES
int,string,string
---- RESULTS
1,'Alex','view'
2,'Lisa','download'
3,'Alan','click'
4,'Alex','view'
====
---- QUERY
# Test filter NULL
SELECT * from iceberg_partitioned_orc_external
where action = NULL
---- TYPES
int,string,string
---- RESULTS
====
---- QUERY
# Test filter !=NULL
SELECT * from iceberg_partitioned_orc_external
where action != NULL
---- TYPES
int,string,string
---- RESULTS
====
---- QUERY
SHOW PARTITIONS iceberg_partitioned_orc_external
---- TYPES
string,bigint,bigint
---- RESULTS
'{"action":"click"}',6,6
'{"action":"download"}',6,6
'{"action":"view"}',8,8
====
---- QUERY
SHOW FILES in iceberg_partitioned_orc_external
---- LABELS
Path,Size,Partition,EC Policy
---- RESULTS
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=click/00004-4-0982a5d3-48c0-4dd0-ab87-d24190894251-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=click/00014-14-dc56d2c8-e285-428d-b81e-f3d07ec53c12-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=click/00015-15-d4a071f4-5d57-493e-8d21-8f82655087e4-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=click/00019-19-e9fa9638-8693-43dc-b1ba-2d8dc390b585-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=click/00020-20-4526ff61-8991-4645-b448-bf3535492111-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=click/00028-28-439376ff-3d17-4494-94ba-586fa00caadd-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=download/00003-3-fb7663c5-aade-4690-bdfc-2334d605a891-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=download/00007-7-fc53a761-1ee2-4ce4-9507-c9917917d2c9-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=download/00011-11-8887c762-b6a8-4e2c-b1e0-6069d6141917-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=download/00012-12-a85e02aa-ff28-4311-b996-a83f67a5e39b-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=download/00022-22-dea5a8ec-ea06-4688-8293-486a62563ef3-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=download/00025-25-d182fe7e-de19-4df8-ac19-27bbfe17b5bd-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=view/00001-1-d5df20b1-6ce6-486a-b084-ea55b7954431-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=view/00006-6-b30cc130-03a1-45e5-b927-d80545593f9a-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=view/00009-9-6476cc9e-9b5a-48d3-8cce-ea7ebb2d904f-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=view/00017-17-c2ab6dc5-3586-4b45-8a3c-860fdc71980d-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=view/00023-23-fd03c61f-8c73-4639-8974-1f6431a30bc5-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=view/00027-27-9baec6d2-8e31-4d19-8259-1a9e546aaea5-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=view/00030-30-433b1afa-9fee-4581-89fb-105483ebf1a2-00000.orc'.*,'','$ERASURECODE_POLICY'
row_regex:'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc/data/action=view/00031-31-e0156a2d-4240-4c8e-9724-6ad3231cf178-00000.orc'.*,'','$ERASURECODE_POLICY'
---- TYPES
STRING,STRING,STRING,STRING
====
---- QUERY
describe formatted iceberg_partitioned;
---- RESULTS: VERIFY_IS_SUBSET
'Location:           ','$NAMENODE/test-warehouse/iceberg_test/iceberg_partitioned','NULL'
'','write.format.default','parquet             '
'','iceberg.catalog     ','hadoop.tables       '
---- TYPES
string, string, string
====
---- QUERY
describe formatted iceberg_non_partitioned;
---- RESULTS: VERIFY_IS_SUBSET
'Location:           ','$NAMENODE/test-warehouse/iceberg_test/iceberg_non_partitioned','NULL'
'','write.format.default','parquet             '
'','iceberg.catalog     ','hadoop.tables       '
---- TYPES
string, string, string
====
---- QUERY
describe formatted hadoop_catalog_test_external;
---- RESULTS: VERIFY_IS_SUBSET
'Location:           ','$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test/functional_parquet/hadoop_catalog_test','NULL'
'','iceberg.catalog_location','$WAREHOUSE_LOCATION_PREFIX/test-warehouse/iceberg_test/hadoop_catalog/hadoop_catalog_test'
'','iceberg.table_identifier','functional_parquet.hadoop_catalog_test'
'','write.format.default','parquet             '
'','iceberg.catalog     ','hadoop.catalog      '
---- TYPES
string, string, string
====
---- QUERY
describe formatted iceberg_partitioned_orc_external;
---- RESULTS: VERIFY_IS_SUBSET
'Location:           ','$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc/functional_parquet/iceberg_partitioned_orc','NULL'
'','iceberg.catalog_location','$WAREHOUSE_LOCATION_PREFIX/test-warehouse/iceberg_test/hadoop_catalog/iceberg_partitioned_orc'
'','iceberg.table_identifier','functional_parquet.iceberg_partitioned_orc'
'','write.format.default','orc                 '
'','iceberg.catalog     ','hadoop.catalog      '
---- TYPES
string, string, string
====
---- QUERY
SELECT count(*) from iceberg_resolution_test_external;
---- TYPES
bigint
---- RESULTS
20
====
---- QUERY
SELECT phone.pos,phone.item
FROM iceberg_resolution_test_external,iceberg_resolution_test_external.phone
WHERE id=1 ORDER BY phone.pos;
---- TYPES
bigint,string
---- RESULTS
0,'1-212-100-1111'
1,'1-212-100-1112'
====
---- QUERY
SELECT favorites.key,favorites.value
FROM iceberg_resolution_test_external,iceberg_resolution_test_external.favorites
WHERE id=1 AND favorites.key='sport';
---- TYPES
string,string
---- RESULTS
'sport','swimming'
====
---- QUERY
SELECT favorites.value,count(1)
FROM iceberg_resolution_test_external.favorites
WHERE favorites.key='food'
GROUP BY favorites.value ORDER BY favorites.value;
---- TYPES
string,bigint
---- RESULTS
'beef',10
'chicken',4
'pumpkin',6
====
---- QUERY
SELECT current_address.street_address.street_number,
current_address.street_address.street_name,
current_address.street_address.street_type,
current_address.country,
current_address.postal_code
FROM iceberg_resolution_test_external WHERE id=1;
---- TYPES
int,string,string,string,string
---- RESULTS
100,'Wall Street','Street','US','10005'
====
---- QUERY
SELECT count(distinct current_address.street_address.street_number),
count(distinct current_address.country)
FROM iceberg_resolution_test_external;
---- TYPES
bigint,bigint
---- RESULTS
3,1
====
---- QUERY
describe formatted iceberg_resolution_test_external;
---- RESULTS: VERIFY_IS_SUBSET
'Location:           ','$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test','NULL'
'','iceberg.catalog_location','$WAREHOUSE_LOCATION_PREFIX/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test'
'','iceberg.table_identifier','functional_parquet.iceberg_resolution_test'
'','write.format.default','parquet             '
'','iceberg.catalog     ','hadoop.catalog      '
---- TYPES
string, string, string
====
---- QUERY
SHOW FILES in iceberg_resolution_test_external;
---- LABELS
Path,Size,Partition,EC Policy
---- RESULTS
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-08/action=view/00001-1-13d79bd6-4b97-4680-b4e1-52e93b6ce04e-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-08/action=view/00006-6-305c9b7a-f42d-4245-b806-dfa7a792593f-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-08/action=view/00009-9-224fe2d6-b0d9-42d6-bc95-15f52ecb29ad-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-08/action=view/00017-17-1a38e294-5992-48d9-a18e-08e129bb418c-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-08/action=view/00023-23-74cfcf22-3de2-489a-b1ec-d5141e75a8e8-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-08/action=view/00027-27-5f91dc85-b8f3-4cc2-a5c6-38b7fee49709-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-08/action=view/00030-30-dc3510cc-e765-43bc-be03-c5561a8d50a3-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-08/action=view/00031-31-364afc4a-b718-406d-a532-58fab5c8f85d-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-09/action=click/00004-4-7a1a8e89-8aeb-4405-be64-76557432cf21-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-09/action=click/00014-14-765d552a-fddc-42f3-adfd-ecba20a01d80-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-09/action=click/00015-15-9957db43-3b9a-4a50-9946-d003cc1d461c-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-09/action=click/00019-19-1e1895d0-1f42-4c30-989f-968802831077-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-09/action=click/00020-20-bb59ac6d-aeee-4c35-9f8a-1a03127d33b8-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-09/action=click/00028-28-44ba3ad9-737c-4416-a32c-501cc9a4aa90-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-10/action=download/00003-3-31478795-ff6a-4a20-9fff-8dc4907c1ba7-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-10/action=download/00007-7-3b4a35cb-22b5-4a5d-932b-89f222b0b2c7-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-10/action=download/00011-11-a40c4c8c-de16-487a-89b3-ee8e58b4fd07-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-10/action=download/00012-12-ed4ba706-2ace-4d41-b475-6bda3ba72306-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-10/action=download/00022-22-57f5e226-5f8f-49b9-b998-039b8362b7a0-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
'$NAMENODE/test-warehouse/iceberg_test/hadoop_catalog/iceberg_resolution_test/functional_parquet/iceberg_resolution_test/data/event_time_hour=2020-01-01-10/action=download/00025-25-5fec3538-052d-493e-9479-b59fc8aece0f-00000.parquet',regex:.*,'','$ERASURECODE_POLICY'
---- TYPES
STRING,STRING,STRING,STRING
====
---- QUERY
describe formatted iceberg_uppercase_col;
---- RESULTS: VERIFY_IS_SUBSET
'region','string','from deserializer'
'nested_struct','struct<a:int,b:array<int>,c:struct<d:array<array<struct<e:int,f:string>>>>,g:map<string,struct<h:struct<i:array<double>>>>>','NULL'
---- TYPES
string, string, string
====
---- QUERY
SELECT * FROM iceberg_uppercase_col;
---- RESULTS
---- TYPES
STRING
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
order by i;
---- RESULTS
-2,1969-01-01 00:00:00
-1,1969-01-01 00:15:00
0,2021-10-31 00:15:00
1,2021-10-31 01:15:00
2,2021-01-10 11:00:00
3,2022-04-10 22:04:00
4,2022-04-11 10:04:55
---- TYPES
INT, TIMESTAMP
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
0,2021-10-31 02:15:00
1,2021-10-31 02:15:00
2,2021-01-10 12:00:00
3,2022-04-11 00:04:00
4,2022-04-11 12:04:55
---- TYPES
INT, TIMESTAMP
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '1969-01-01 00:00:00';
---- RESULTS
-2,1969-01-01 00:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '1969-01-01 00:15:00';
---- RESULTS
-1,1969-01-01 00:15:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '2021-10-31 00:15:00';
---- RESULTS
0,2021-10-31 00:15:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '2021-10-31 01:15:00';
---- RESULTS
1,2021-10-31 01:15:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '2021-01-10 11:00:00';
---- RESULTS
2,2021-01-10 11:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '2022-04-10 22:04:00';
---- RESULTS
3,2022-04-10 22:04:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '2022-04-11 10:04:55';
---- RESULTS
4,2022-04-11 10:04:55
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts < '2021-10-31 01:15:00'
order by i;
---- RESULTS
-2,1969-01-01 00:00:00
-1,1969-01-01 00:15:00
0,2021-10-31 00:15:00
2,2021-01-10 11:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 3
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts > '1969-01-01 00:00:00'
order by i;
---- RESULTS
-1,1969-01-01 00:15:00
0,2021-10-31 00:15:00
1,2021-10-31 01:15:00
2,2021-01-10 11:00:00
3,2022-04-10 22:04:00
4,2022-04-11 10:04:55
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 6
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts > '1969-01-01 00:15:00' and  ts < '2021-10-31 01:15:00'
order by i;
---- RESULTS
0,2021-10-31 00:15:00
2,2021-01-10 11:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 2
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts >= '1969-01-01 00:15:00' and  ts <= '2021-10-31 01:15:00'
order by i;
---- RESULTS
-1,1969-01-01 00:15:00
0,2021-10-31 00:15:00
1,2021-10-31 01:15:00
2,2021-01-10 11:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 4
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamptz_part
WHERE ts between '1969-01-01 00:15:00' and '2021-10-31 01:15:00'
order by i;
---- RESULTS
-1,1969-01-01 00:15:00
0,2021-10-31 00:15:00
1,2021-10-31 01:15:00
2,2021-01-10 11:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 4
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '1969-01-01 01:00:00';
---- RESULTS
-2,1969-01-01 01:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '1969-01-01 01:15:00';
---- RESULTS
-1,1969-01-01 01:15:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
# Query ambigous timestamp. '2021-10-31 02:15:00' converts
# to '2021-10-31 00:15:00 UTC' and '2021-10-31 01:15:00 UTC' due to DST.
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '2021-10-31 02:15:00';
---- RESULTS
0,2021-10-31 02:15:00
1,2021-10-31 02:15:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 6
aggregation(SUM, NumStatsFilteredRowGroups): 4
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '2021-01-10 12:00:00';
---- RESULTS
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '2022-04-11 00:04:00';
---- RESULTS
3,2022-04-11 00:04:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts = '2022-04-11 12:04:55';
---- RESULTS
4,2022-04-11 12:04:55
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
1,2021-10-31 02:15:00
2,2021-01-10 12:00:00
3,2022-04-11 00:04:00
4,2022-04-11 12:04:55
---- TYPES
INT, TIMESTAMP
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
1,2021-10-31 02:15:00
2,2021-01-10 12:00:00
3,2022-04-11 00:04:00
4,2022-04-11 12:04:55
---- TYPES
INT, TIMESTAMP
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts < '2021-10-31 02:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 6
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts > '1969-01-01 01:00:00'
order by i;
---- RESULTS
-1,1969-01-01 01:15:00
0,2021-10-31 02:15:00
1,2021-10-31 02:15:00
2,2021-01-10 12:00:00
3,2022-04-11 00:04:00
4,2022-04-11 12:04:55
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 6
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts > '1969-01-01 00:15:00' and  ts < '2021-10-31 02:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 6
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts >= '1969-01-01 00:15:00' and  ts <= '2021-10-31 02:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
0,2021-10-31 02:15:00
1,2021-10-31 02:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 6
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamptz_part
WHERE ts between '1969-01-01 00:15:00' and '2021-10-31 02:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
0,2021-10-31 02:15:00
1,2021-10-31 02:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 6
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '1969-01-01 01:00:00';
---- RESULTS
-2,1969-01-01 01:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '1969-01-01 01:15:00';
---- RESULTS
-1,1969-01-01 01:15:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '2021-10-31 02:15:00';
---- RESULTS
1,2021-10-31 02:15:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '2021-01-10 12:00:00';
---- RESULTS
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '2022-04-11 00:04:00';
---- RESULTS
3,2022-04-11 00:04:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '2022-04-11 12:04:55';
---- RESULTS
4,2022-04-11 12:04:55
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts < '2021-10-31 02:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 2
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts > '1969-01-01 01:00:00'
order by i;
---- RESULTS
-1,1969-01-01 01:15:00
1,2021-10-31 02:15:00
2,2021-01-10 12:00:00
3,2022-04-11 00:04:00
4,2022-04-11 12:04:55
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 5
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts > '1969-01-01 00:15:00' and  ts < '2021-10-31 01:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 2
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts >= '1969-01-01 00:15:00' and  ts <= '2021-10-31 01:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 2
====
---- QUERY
SET TIMEZONE='UTC';
SELECT * FROM iceberg_timestamp_part
WHERE ts between '1969-01-01 00:15:00' and '2021-10-31 01:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 2
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '1969-01-01 01:00:00';
---- RESULTS
-2,1969-01-01 01:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '1969-01-01 01:15:00';
---- RESULTS
-1,1969-01-01 01:15:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '2021-10-31 02:15:00';
---- RESULTS
1,2021-10-31 02:15:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '2021-01-10 12:00:00';
---- RESULTS
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '2022-04-11 00:04:00';
---- RESULTS
3,2022-04-11 00:04:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts = '2022-04-11 12:04:55';
---- RESULTS
4,2022-04-11 12:04:55
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 1
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts < '2021-10-31 02:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 2
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts > '1969-01-01 01:00:00'
order by i;
---- RESULTS
-1,1969-01-01 01:15:00
1,2021-10-31 02:15:00
2,2021-01-10 12:00:00
3,2022-04-11 00:04:00
4,2022-04-11 12:04:55
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 5
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts > '1969-01-01 00:15:00' and  ts < '2021-10-31 02:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 2
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts >= '1969-01-01 00:15:00' and  ts <= '2021-10-31 02:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
1,2021-10-31 02:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 3
====
---- QUERY
SET TIMEZONE='Europe/Budapest';
SELECT * FROM iceberg_timestamp_part
WHERE ts between '1969-01-01 00:15:00' and '2021-10-31 02:15:00'
order by i;
---- RESULTS
-2,1969-01-01 01:00:00
-1,1969-01-01 01:15:00
1,2021-10-31 02:15:00
2,2021-01-10 12:00:00
---- TYPES
INT, TIMESTAMP
---- RUNTIME_PROFILE
aggregation(SUM, NumRowGroups): 3
====
---- QUERY
# IMPALA-11811 query that generates unregistered predicates.
select i.id from  iceberg_partitioned i, iceberg_partitioned j
where i.action in ('view') and j.id=1 and j.id=i.id;
---- RESULTS
1
---- TYPES
int
====
---- QUERY
# We can query a snapshot if it doesn't have equality deletes.
select * from iceberg_v2_delete_equality for system_version as of 3207673167795000154;
---- RESULTS
1,'test_1_base'
2,'test_2_base'
---- TYPES
BIGINT,STRING
====
---- QUERY
# Regression test for IMPALA-12580: predicate filtering could throw UnsupportedOperationException
select i from functional_parquet.iceberg_alltypes_part
where i = 1 and p_bigint = 10 + i and p_int = p_bigint - 10;
---- RESULTS
1
---- TYPES
INT
====
---- QUERY
# Regression test for IMPALA-12580: predicate filtering could throw UnsupportedOperationException
select p_int from functional_parquet.iceberg_alltypes_part where i = 1 and p_int = i;
---- RESULTS
1
---- TYPES
INT
====
---- QUERY
# Regression test for IMPALA-12879: Conjunct not referring to table field causes ERROR
# for Iceberg table
select * from iceberg_avro_format where rand(6) < 0.5;
---- RESULTS
1,'A',0.5,true
3,'C',2.5,false
---- TYPES
INT, STRING, DOUBLE, BOOLEAN
====
---- QUERY
# Regression test for IMPALA-12879: Conjunct not referring to table field causes ERROR
# for Iceberg table
select * from iceberg_avro_format where rand(6) < 0.5 and string_col = 'C';
---- RESULTS
3,'C',2.5,false
---- TYPES
INT, STRING, DOUBLE, BOOLEAN
====
---- QUERY
# Regression test for IMPALA-12879: Conjunct not referring to table field causes ERROR
# for Iceberg table.
# Scanning iceberg_v2_positional_update_all_rows involves a UNION node which behaves
# differently if it is scheduled on 1 node or 2 nodes. Setting num_nodes is not
# allowed, so let's just check that not all rows are returned.
select count(*) < 6 from iceberg_v2_positional_update_all_rows where rand(6) < 0.5;
---- RESULTS
true
---- TYPES
BOOLEAN
====
---- QUERY
# Regression test for IMPALA-12879: Conjunct not referring to table field causes ERROR
# for Iceberg table. Also time travel is involved
select * from iceberg_v2_positional_update_all_rows for system_version as of 5392552459484846077 where rand(6) < 0.5;
---- RESULTS
1,'a'
3,'c'
1,'A'
3,'C'
---- TYPES
INT, STRING
====
---- QUERY
# Regression test for IMPALA-12879: Conjunct not referring to table field causes ERROR
# for Iceberg table. Also time travel is involved
select count(*) from iceberg_v2_positional_update_all_rows for system_version as of 5392552459484846077 where rand(6) < 0.5;
---- RESULTS
4
---- TYPES
BIGINT
====
---- QUERY
# Regression test for IMPALA-12879: Conjunct not referring to table field causes ERROR
# for Iceberg table
# iceberg_partition_evolution is written during data loading, so the results are not deterministic.
select count(*) < 100 from iceberg_partition_evolution where rand(3) < 0.1 and month = 1 and id < 100;
---- RESULTS
true
---- TYPES
BOOLEAN
====
---- QUERY
# Regression test for IMPALA-12879: Conjunct not referring to table field causes ERROR
# for Iceberg table
# iceberg_partition_evolution is written during data loading, so the results are not deterministic.
select count(*) < 6000 from iceberg_partition_evolution where rand(3) < 0.1;
---- RESULTS
true
---- TYPES
BOOLEAN
====
---- QUERY
# Regression test for IMPALA-12879: Conjunct not referring to table field causes ERROR
# for Iceberg table
# iceberg_partition_evolution is written during data loading, so the results are not deterministic.
select count(*) < 6000 from iceberg_partition_evolution where rand(4) < 0.1;
---- RESULTS
true
---- TYPES
BOOLEAN
====
---- QUERY
# Regression test for IMPALA-12879: Conjunct not referring to table field causes ERROR
# for Iceberg table
# iceberg_partition_evolution is written during data loading, so the results are not deterministic.
select count(*) < 300 from iceberg_partition_evolution where rand(3) < 0.1 and month = 1;
---- RESULTS
true
---- TYPES
BOOLEAN
====
